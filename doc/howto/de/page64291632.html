<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- 4.12.2 -->
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="combined.css"/>
    <script src="split/split.min.js"></script>
    <link rel="stylesheet" href="inline_styles.css"/>
    <style type="text/css">
        /* <![CDATA[ */
            
        /* ]]> */
    </style>
</head>
<body>

<div class="full-height-container">
<div id="sidebar" class="split">
<div class="navgroup" id="search">
<form action="search.html" class="aui">
<input type="text" name="q" id="tipue_search_input" class="medium-field text">
<input class="button submit" type="submit" value="Search"></form>
</div>
<div class="navgroup" id="navigation">
<ul><li><span>How-To CentraXX: CentraXX FHIR Custom Export</span></li></ul>
</div>
</div>
<div id="content" class="split">
<div class='wiki-page'>
<div class='wiki-title'>
<h1 class='page-title-lvl-cover' id='Bookmark1'>How-To CentraXX: CentraXX FHIR Custom Export</h1>
</div>
<div class='wiki-content'>
<div class="table-wrap"><table class="wrapped relative-table confluenceTable" style="width: 60.3401%;; font-size:0.9em"><colgroup><col style="" /><col style="" /><col style="" /><col style="" /></colgroup><tbody><tr><th style="width: 143.0px;" class="confluenceTh"><p>Titel</p></th><th colspan="3" style="width: 370.0px;" class="confluenceTh"><p>CentraXX FHIR Custom Export</p></th></tr><tr><td style="" class="confluenceTd"><p><strong>Ersteller</strong></p></td><td colspan="3" style="" class="confluenceTd"><p><a class="confluence-userlink user-mention" data-username="jonas.kuettner" href="http://confluence.kairosbochum.de/display/~jonas.kuettner" data-linked-resource-id="45122248" data-linked-resource-version="1" data-linked-resource-type="userinfo" data-base-url="http://confluence.kairosbochum.de" title="http://confluence.kairosbochum.de/display/~jonas.kuettner">Jonas Küttner</a><span class="confluence-link confluence-userlink user-mention">, <a class="confluence-userlink user-mention current-user-mention" data-username="mike" href="http://confluence.kairosbochum.de/display/~mike" data-linked-resource-id="753677" data-linked-resource-version="1" data-linked-resource-type="userinfo" data-base-url="http://confluence.kairosbochum.de" title="http://confluence.kairosbochum.de/display/~mike">Mike Wähnert</a> <br /></span></p></td></tr><tr><td style="" class="confluenceTd"><p><strong>Datum</strong></p></td><td colspan="3" style="" class="confluenceTd"><p>2021-02-22</p></td></tr><tr><td style="" class="confluenceTd"><p><strong>Version</strong></p></td><td colspan="3" style="" class="confluenceTd"><p>1.9</p></td></tr><tr><td style="" class="confluenceTd"><p><strong>Status</strong></p></td><td colspan="3" style="" class="confluenceTd"><p>Final</p></td></tr><tr><td style="" class="confluenceTd"><p><strong>Verbleib</strong></p></td><td colspan="3" style="" class="confluenceTd"><p>Zu Schulungszwecken externe Weitergabe erlaubt.</p></td></tr><tr><td style="" class="confluenceTd"><p><strong>Verlauf</strong></p></td><td style="" class="confluenceTd"><p><strong>Version</strong></p></td><td style="" class="confluenceTd"><p><strong>Beschreibung</strong></p></td><td style="" class="confluenceTd"><p><strong>Bearbeiter</strong></p></td></tr><tr><td style="" class="confluenceTd"><p>2020-12-14</p></td><td style="" class="confluenceTd"><p>0.1</p></td><td style="" class="confluenceTd"><p>Vorlagen und Agenda</p></td><td style="" class="confluenceTd"><p><a class="confluence-userlink user-mention current-user-mention" data-username="mike" href="http://confluence.kairosbochum.de/display/~mike" data-linked-resource-id="753677" data-linked-resource-version="1" data-linked-resource-type="userinfo" data-base-url="http://confluence.kairosbochum.de" title="http://confluence.kairosbochum.de/display/~mike">Mike Wähnert</a></p></td></tr><tr><td style="" class="confluenceTd"><p>2021-01-04</p></td><td style="" class="confluenceTd"><p>0.2</p></td><td style="" class="confluenceTd"><p>Initialer Entwurf</p></td><td style="" class="confluenceTd"><p><a class="confluence-userlink user-mention" data-username="jonas.kuettner" href="http://confluence.kairosbochum.de/display/~jonas.kuettner" data-linked-resource-id="45122248" data-linked-resource-version="1" data-linked-resource-type="userinfo" data-base-url="http://confluence.kairosbochum.de" title="http://confluence.kairosbochum.de/display/~jonas.kuettner">Jonas Küttner</a></p></td></tr><tr><td style="" class="confluenceTd"><p>2021-01-12</p></td><td style="" class="confluenceTd"><p>0.3</p></td><td style="" class="confluenceTd"><p>Korrekturen</p></td><td style="" class="confluenceTd"><p><a class="confluence-userlink user-mention current-user-mention" data-username="mike" href="http://confluence.kairosbochum.de/display/~mike" data-linked-resource-id="753677" data-linked-resource-version="1" data-linked-resource-type="userinfo" data-base-url="http://confluence.kairosbochum.de" title="http://confluence.kairosbochum.de/display/~mike">Mike Wähnert</a></p></td></tr><tr><td style="" class="confluenceTd"><p>2021-01-12</p></td><td style="" class="confluenceTd"><p>0.4</p></td><td style="" class="confluenceTd"><p>Kleine Korrekturen</p></td><td style="" class="confluenceTd"><p><a class="confluence-userlink user-mention" data-username="jonas.kuettner" href="http://confluence.kairosbochum.de/display/~jonas.kuettner" data-linked-resource-id="45122248" data-linked-resource-version="1" data-linked-resource-type="userinfo" data-base-url="http://confluence.kairosbochum.de" title="http://confluence.kairosbochum.de/display/~jonas.kuettner">Jonas Küttner</a></p></td></tr><tr><td style="" class="confluenceTd"><p>2021-01-14</p></td><td style="" class="confluenceTd"><p>0.5</p></td><td style="" class="confluenceTd"><p>Configs f&uuml;r TLS/SSL<br />Umfang, Zielgruppe, Scope<br />UML-Diagramm<br />Ausleitung in Blaze</p></td><td style="" class="confluenceTd"><p><a class="confluence-userlink user-mention" data-username="jonas.kuettner" href="http://confluence.kairosbochum.de/display/~jonas.kuettner" data-linked-resource-id="45122248" data-linked-resource-version="1" data-linked-resource-type="userinfo" data-base-url="http://confluence.kairosbochum.de" title="http://confluence.kairosbochum.de/display/~jonas.kuettner">Jonas Küttner</a></p></td></tr><tr><td style="" class="confluenceTd"><p>2021-01-16</p></td><td style="" class="confluenceTd"><p>0.6</p></td><td style="" class="confluenceTd"><p>Ausleitung-Filesystem<br />allgemeine &Uuml;berarbeitung</p></td><td style="" class="confluenceTd"><p><a class="confluence-userlink user-mention" data-username="jonas.kuettner" href="http://confluence.kairosbochum.de/display/~jonas.kuettner" data-linked-resource-id="45122248" data-linked-resource-version="1" data-linked-resource-type="userinfo" data-base-url="http://confluence.kairosbochum.de" title="http://confluence.kairosbochum.de/display/~jonas.kuettner">Jonas Küttner</a></p></td></tr><tr><td style="" class="confluenceTd"><p>2021-01-18</p></td><td style="" class="confluenceTd"><p>1.0</p></td><td style="" class="confluenceTd"><p>Korrekturen</p><p>Initialer Release</p></td><td style="" class="confluenceTd"><p><a class="confluence-userlink user-mention current-user-mention" data-username="mike" href="http://confluence.kairosbochum.de/display/~mike" data-linked-resource-id="753677" data-linked-resource-version="1" data-linked-resource-type="userinfo" data-base-url="http://confluence.kairosbochum.de" title="http://confluence.kairosbochum.de/display/~mike">Mike Wähnert</a></p></td></tr><tr><td style="" class="confluenceTd"><p>2021-01-21</p></td><td style="" class="confluenceTd"><p>1.1</p></td><td style="" class="confluenceTd"><p>Finale Korrekturen</p></td><td style="" class="confluenceTd"><p><a class="confluence-userlink user-mention" data-username="jovana.radlovic" href="http://confluence.kairosbochum.de/display/~jovana.radlovic" data-linked-resource-id="26414791" data-linked-resource-version="2" data-linked-resource-type="userinfo" data-base-url="http://confluence.kairosbochum.de" title="http://confluence.kairosbochum.de/display/~jovana.radlovic">Jovana Radlovic</a></p></td></tr><tr><td style="" class="confluenceTd"><p>2021-02-05</p></td><td style="" class="confluenceTd"><p>1.2</p></td><td style="" class="confluenceTd"><p>Update Installation des Beispiel Projekts von GitHub</p></td><td style="" class="confluenceTd"><p><a class="confluence-userlink user-mention" data-username="jonas.kuettner" href="http://confluence.kairosbochum.de/display/~jonas.kuettner" data-linked-resource-id="45122248" data-linked-resource-version="1" data-linked-resource-type="userinfo" data-base-url="http://confluence.kairosbochum.de" title="http://confluence.kairosbochum.de/display/~jonas.kuettner">Jonas Küttner</a></p></td></tr><tr><td style="" class="confluenceTd"><p>2021-02-11</p></td><td style="" class="confluenceTd"><p>1.3</p></td><td style="" class="confluenceTd"><p>Update der Installation der Kairos-FHIR-DSL-Bibliothek &uuml;ber GitHub, Erl&auml;uterung Code-Completion f&uuml;r JPA-Model, Ersetzung der Strings zu Meta-Model-Methoden in Beispielen, Neuerung der Screenshots</p></td><td style="" class="confluenceTd"><p><a class="confluence-userlink user-mention" data-username="jonas.kuettner" href="http://confluence.kairosbochum.de/display/~jonas.kuettner" data-linked-resource-id="45122248" data-linked-resource-version="1" data-linked-resource-type="userinfo" data-base-url="http://confluence.kairosbochum.de" title="http://confluence.kairosbochum.de/display/~jonas.kuettner">Jonas Küttner</a></p></td></tr><tr><td style="" class="confluenceTd"><p>2021-02-12</p></td><td style="" class="confluenceTd"><p>1.4</p></td><td style="" class="confluenceTd"><p>Versionsnummer DSL und IntelliJ aktualisiert.</p></td><td style="" class="confluenceTd"><p><a class="confluence-userlink user-mention" data-username="jonas.kuettner" href="http://confluence.kairosbochum.de/display/~jonas.kuettner" data-linked-resource-id="45122248" data-linked-resource-version="1" data-linked-resource-type="userinfo" data-base-url="http://confluence.kairosbochum.de" title="http://confluence.kairosbochum.de/display/~jonas.kuettner">Jonas Küttner</a></p></td></tr><tr><td style="" class="confluenceTd"><p>2021-02-12</p></td><td style="" class="confluenceTd"><p>1.5</p></td><td style="" class="confluenceTd"><p>Korrekturen</p></td><td style="" class="confluenceTd"><p><a class="confluence-userlink user-mention current-user-mention" data-username="mike" href="http://confluence.kairosbochum.de/display/~mike" data-linked-resource-id="753677" data-linked-resource-version="1" data-linked-resource-type="userinfo" data-base-url="http://confluence.kairosbochum.de" title="http://confluence.kairosbochum.de/display/~mike">Mike Wähnert</a></p></td></tr><tr><td style="" class="confluenceTd"><p>2021-02-12</p></td><td style="" class="confluenceTd"><p>1.6</p></td><td style="" class="confluenceTd"><p>Korrekturen, Erweiterung JPA-Navigation</p></td><td style="" class="confluenceTd"><p><a class="confluence-userlink user-mention" data-username="jonas.kuettner" href="http://confluence.kairosbochum.de/display/~jonas.kuettner" data-linked-resource-id="45122248" data-linked-resource-version="1" data-linked-resource-type="userinfo" data-base-url="http://confluence.kairosbochum.de" title="http://confluence.kairosbochum.de/display/~jonas.kuettner">Jonas Küttner</a></p></td></tr><tr><td style="" class="confluenceTd"><p>2021-02-18</p></td><td style="" class="confluenceTd"><p>1.7</p></td><td style="" class="confluenceTd"><p>Korrekturen, &Auml;nderung der Beschreibung der Installation des example-Projekts auf Nutzung des Latest Release.</p><p>Unn&ouml;tiges Code-Snippet entfernt</p></td><td style="" class="confluenceTd"><p><a class="confluence-userlink user-mention" data-username="jonas.kuettner" href="http://confluence.kairosbochum.de/display/~jonas.kuettner" data-linked-resource-id="45122248" data-linked-resource-version="1" data-linked-resource-type="userinfo" data-base-url="http://confluence.kairosbochum.de" title="http://confluence.kairosbochum.de/display/~jonas.kuettner">Jonas Küttner</a></p></td></tr><tr><td colspan="1" class="confluenceTd" style="padding:0.45em"><p>2021-02-18</p></td><td colspan="1" class="confluenceTd" style="padding:0.45em"><p>1.8</p></td><td colspan="1" class="confluenceTd" style="padding:0.45em"><p>Einf&uuml;hrung des inkrementellen Transports</p><p>Anpassung von Pfaden und Bezeichnungen von nfn zu fhir-custom</p></td><td colspan="1" class="confluenceTd" style="padding:0.45em"><p><a class="confluence-userlink user-mention" data-username="jonas.kuettner" href="http://confluence.kairosbochum.de/display/~jonas.kuettner" data-linked-resource-id="45122248" data-linked-resource-version="1" data-linked-resource-type="userinfo" data-base-url="http://confluence.kairosbochum.de" title="http://confluence.kairosbochum.de/display/~jonas.kuettner">Jonas Küttner</a></p></td></tr><tr><td colspan="1" class="confluenceTd" style="padding:0.45em"><p>2021-02-22</p></td><td colspan="1" class="confluenceTd" style="padding:0.45em"><p>1.9</p></td><td colspan="1" class="confluenceTd" style="padding:0.45em"><p>Korrekturen + Einf&uuml;gen von Referenzen und Quellen</p></td><td colspan="1" class="confluenceTd" style="padding:0.45em"><div class="content-wrapper"><p><a class="confluence-userlink user-mention" data-username="bieling" href="http://confluence.kairosbochum.de/display/~bieling" data-linked-resource-id="753671" data-linked-resource-version="2" data-linked-resource-type="userinfo" data-base-url="http://confluence.kairosbochum.de" title="http://confluence.kairosbochum.de/display/~bieling">Dennis Spiegel</a></p></div></td></tr></tbody></table></div><a name="Bookmark2"></a><h1 class="auto-cursor-target" id="Bookmark2">Versionierung</h1><div class="table-wrap"><table class="wrapped confluenceTable" style="font-size:0.9em"><colgroup><col /><col /><col /><col /><col /></colgroup><tbody><tr><th class="confluenceTh">Version</th><th class="confluenceTh">Datum</th><th class="confluenceTh">Bearbeiter/in</th><th class="confluenceTh">Datei</th><th colspan="1" class="confluenceTh">Kommentar</th></tr><tr><td class="confluenceTd" style="padding:0.45em">1.9</td><td class="confluenceTd" style="padding:0.45em">2021-02-22</td><td class="confluenceTd" style="padding:0.45em">Mike W&auml;hnert</td><td class="confluenceTd" style="padding:0.45em"><div class="content-wrapper"><p><a href="http://confluence.kairosbochum.de/download/attachments/64291632/CXX_FHIR_Custom_Export.pdf?version=4&amp;modificationDate=1614017638748&amp;api=v2" data-linked-resource-id="65898216" data-linked-resource-version="4" data-linked-resource-type="attachment" data-linked-resource-default-alias="CXX_FHIR_Custom_Export.pdf" data-nice-type="PDF Document" data-linked-resource-content-type="application/pdf" data-linked-resource-container-id="64291632" data-linked-resource-container-version="102" title="http://confluence.kairosbochum.de/download/attachments/64291632/CXX_FHIR_Custom_Export.pdf?version=4&amp;modificationDate=1614017638748&amp;api=v2">CXX_FHIR_Custom_Export.pdf</a></p></div></td><td colspan="1" class="confluenceTd" style="padding:0.45em"><br /></td></tr><tr><td colspan="1" class="confluenceTd" style="padding:0.45em">1.9</td><td colspan="1" class="confluenceTd" style="padding:0.45em">2021-02-22</td><td colspan="1" class="confluenceTd" style="padding:0.45em">Mike W&auml;hnert</td><td colspan="1" class="confluenceTd" style="padding:0.45em"><div class="content-wrapper"><p><a href="http://confluence.kairosbochum.de/download/attachments/64291632/CXX_FHIR_Custom_Export.doc?version=1&amp;modificationDate=1614017636644&amp;api=v2" data-linked-resource-id="65900098" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="CXX_FHIR_Custom_Export.doc" data-nice-type="Word Document" data-linked-resource-content-type="application/msword" data-linked-resource-container-id="64291632" data-linked-resource-container-version="102" title="http://confluence.kairosbochum.de/download/attachments/64291632/CXX_FHIR_Custom_Export.doc?version=1&amp;modificationDate=1614017636644&amp;api=v2">CXX_FHIR_Custom_Export.doc</a></p></div></td><td colspan="1" class="confluenceTd" style="padding:0.45em"><br /></td></tr></tbody></table></div><p>                
            </p><div class="pageBreakInPdfExport">
                </div><div class="table-wrap"><table class="wrapped confluenceTable" style="font-size:1.0em"><colgroup><col /></colgroup><tbody><tr><th class="confluenceTh"><a name="Bookmark3"></a><h1 class="auto-cursor-target" id="Bookmark3">Inhaltsverzeichnis</h1></th></tr><tr><td class="confluenceTd" style="padding:0.5em"><div class="content-wrapper"><p><!--inline_style_1--></p><div class="toc-macro rbtoc1614075973180">
<ul class="toc-indentation">
<li><span class="TOCOutline">1</span> <a href="#Bookmark2" title="Versionierung">Versionierung</a></li>
<li><span class="TOCOutline">2</span> <a href="#Bookmark3" title="Inhaltsverzeichnis">Inhaltsverzeichnis</a></li>
<li><span class="TOCOutline">3</span> <a href="#Bookmark4" title="Abk&uuml;rzungsverzeichnis">Abk&uuml;rzungsverzeichnis</a></li>
<li><span class="TOCOutline">4</span> <a href="#Bookmark5" title="Einleitung">Einleitung</a>
<ul class="toc-indentation">
<li><span class="TOCOutline">4.1</span> <a href="#Bookmark6" title="Inhalt des Dokuments">Inhalt des Dokuments</a></li>
<li><span class="TOCOutline">4.2</span> <a href="#Bookmark7" title="Zielgruppe">Zielgruppe</a></li>
<li><span class="TOCOutline">4.3</span> <a href="#Bookmark8" title="&Uuml;berblick &uuml;ber die Schnittstelle">&Uuml;berblick &uuml;ber die Schnittstelle</a>
<ul class="toc-indentation">
<li><span class="TOCOutline">4.3.1</span> <a href="#Bookmark9" title="Scheduled Export:">Scheduled Export:</a></li>
<li><span class="TOCOutline">4.3.2</span> <a href="#Bookmark10" title="Inkrementeller Export:">Inkrementeller Export:</a></li>
</ul>
</li>
</ul>
</li>
<li><span class="TOCOutline">5</span> <a href="#Bookmark11" title="Einrichtung in CentraXX">Einrichtung in CentraXX</a>
<ul class="toc-indentation">
<li><span class="TOCOutline">5.1</span> <a href="#Bookmark12" title="Konfiguration der centraxx-dev.properties">Konfiguration der centraxx-dev.properties</a></li>
<li><span class="TOCOutline">5.2</span> <a href="#Bookmark13" title="Einrichtung eines Projekts am Beispiel einer Ausleitung f&uuml;r das DKTK">Einrichtung eines Projekts am Beispiel einer Ausleitung f&uuml;r das DKTK</a>
<ul class="toc-indentation">
<li><span class="TOCOutline">5.2.1</span> <a href="#Bookmark14" title="ProjectConfig.json">ProjectConfig.json</a></li>
<li><span class="TOCOutline">5.2.2</span> <a href="#Bookmark15" title="ExportResourceMappingConfig.json">ExportResourceMappingConfig.json</a></li>
<li><span class="TOCOutline">5.2.3</span> <a href="#Bookmark16" title="ResourceBundleExportConfig.json">ResourceBundleExportConfig.json</a></li>
</ul>
</li>
</ul>
</li>
<li><span class="TOCOutline">6</span> <a href="#Bookmark17" title="Nutzung der Groovy-DSL-Bibliothek">Nutzung der Groovy-DSL-Bibliothek</a>
<ul class="toc-indentation">
<li><span class="TOCOutline">6.1</span> <a href="#Bookmark18" title="Einleitung/&Uuml;berblick">Einleitung/&Uuml;berblick</a></li>
<li><span class="TOCOutline">6.2</span> <a href="#Bookmark19" title="Voraussetzungen zur Nutzung der Kairos-FHIR-DSL Bibliothek und des Beispielprojekts">Voraussetzungen zur Nutzung der Kairos-FHIR-DSL Bibliothek und des Beispielprojekts</a></li>
<li><span class="TOCOutline">6.3</span> <a href="#Bookmark20" title="Installation des FHIR-Beispielprojekts">Installation des FHIR-Beispielprojekts</a></li>
<li><span class="TOCOutline">6.4</span> <a href="#Bookmark21" title="Installation der FHIR-DSL-Bibliothek">Installation der FHIR-DSL-Bibliothek</a></li>
<li><span class="TOCOutline">6.5</span> <a href="#Bookmark22" title="Verwendung der DSL-Bibliothek zur Erstellung von Transformations-Skripten">Verwendung der DSL-Bibliothek zur Erstellung von Transformations-Skripten</a>
<ul class="toc-indentation">
<li><span class="TOCOutline">6.5.1</span> <a href="#Bookmark23" title="Allgemeines">Allgemeines</a></li>
<li><span class="TOCOutline">6.5.2</span> <a href="#Bookmark24" title="Zusammenbau der FHIR Nachricht mit Groovy Closures">Zusammenbau der FHIR Nachricht mit Groovy Closures</a></li>
<li><span class="TOCOutline">6.5.3</span> <a href="#Bookmark25" title="CXX JPA Meta Model und die Verwendung von context.source mit der JPA-Navigation">CXX JPA Meta Model und die Verwendung von context.source mit der JPA-Navigation</a>
<ul class="toc-indentation">
<li><span class="TOCOutline">6.5.3.1</span> <a href="#Bookmark26" title="JPA Meta Model">JPA Meta Model</a></li>
<li><span class="TOCOutline">6.5.3.2</span> <a href="#Bookmark27" title="Navigation mittels verketteter Methodenaufrufe">Navigation mittels verketteter Methodenaufrufe</a></li>
<li><span class="TOCOutline">6.5.3.3</span> <a href="#Bookmark28" title="Verwendung von Konstanten in Listen-Closures">Verwendung von Konstanten in Listen-Closures</a></li>
</ul>
</li>
<li><span class="TOCOutline">6.5.4</span> <a href="#Bookmark29" title="Definition eigener Methoden, um CentraXX-Entit&auml;ten optimal abzubilden">Definition eigener Methoden, um CentraXX-Entit&auml;ten optimal abzubilden</a></li>
</ul>
</li>
</ul>
</li>
<li><span class="TOCOutline">7</span> <a href="#Bookmark30" title="FHIR-Export in Zielsysteme">FHIR-Export in Zielsysteme</a>
<ul class="toc-indentation">
<li><span class="TOCOutline">7.1</span> <a href="#Bookmark31" title="Ausleitung in einen Blaze Store">Ausleitung in einen Blaze Store</a></li>
<li><span class="TOCOutline">7.2</span> <a href="#Bookmark32" title="Ausleitung ins Dateisystem">Ausleitung ins Dateisystem</a></li>
</ul>
</li>
<li><span class="TOCOutline">8</span> <a href="#Bookmark33" title="Anhang">Anhang</a>
<ul class="toc-indentation">
<li><span class="TOCOutline">8.1</span> <a href="#Bookmark34" title="Beispiel f&uuml;r ausgeleitetes FHIR-Bundle f&uuml;r die FHIR-Ressource &quot;Patient&quot;">Beispiel f&uuml;r ausgeleitetes FHIR-Bundle f&uuml;r die FHIR-Ressource &quot;Patient&quot;</a></li>
</ul>
</li>
</ul>
</div></div></td></tr></tbody></table></div><p><br /></p><p>                
            </p><div class="pageBreakInPdfExport">
                </div><div class="table-wrap"><table class="relative-table wrapped confluenceTable" style="width: 60.6934%;; font-size:1.0em"><colgroup><col style="" /><col style="" /></colgroup><tbody><tr><th colspan="2" class="confluenceTh"><a name="Bookmark4"></a><h1 id="Bookmark4"><strong>Abk&uuml;rzungsverzeichnis</strong></h1></th></tr><tr><td class="confluenceTd" style="padding:0.5em"><p>CXX</p></td><td class="confluenceTd" style="padding:0.5em"><p>CentraXX, siehe&nbsp;<a class="external-link" href="https://www.kairos.de" rel="nofollow">https://www.kairos.de</a></p></td></tr><tr><td class="confluenceTd" style="padding:0.5em"><p>FHIR</p></td><td class="confluenceTd" style="padding:0.5em"><p>Fast Healthcare Interoperability Resources, siehe <a class="external-link" href="https://hl7.org/FHIR/" rel="nofollow">https://hl7.org/FHIR/</a></p></td></tr><tr><td colspan="1" class="confluenceTd" style="padding:0.5em"><p>DSL</p></td><td colspan="1" class="confluenceTd" style="padding:0.5em"><p><span>Domain-specific language</span></p></td></tr><tr><td colspan="1" class="confluenceTd" style="padding:0.5em"><p>JPA</p></td><td colspan="1" class="confluenceTd" style="padding:0.5em"><p><span>Java Persistence API</span></p></td></tr><tr><td colspan="1" class="confluenceTd" style="padding:0.5em"><p><span>DKTK</span></p></td><td colspan="1" class="confluenceTd" style="padding:0.5em"><p><span>Deutsches Konsortium f&uuml;r Translationale Krebsforschung (<a class="external-link" href="https://dktk.dkfz.de/de/home" rel="nofollow">https://dktk.dkfz.de/de/home</a>&nbsp;/&nbsp;<a class="external-link" href="https://simplifier.net/oncology" rel="nofollow">https://simplifier.net/oncology</a>)</span></p></td></tr><tr><td colspan="1" class="confluenceTd" style="padding:0.5em"><p>BBMRI</p></td><td colspan="1" class="confluenceTd" style="padding:0.5em"><p>Biobanking and Biomolecular Resources Research Infrastructure, siehe <a class="external-link" href="https://www.bbmri.de/ueber-gbn/bbmri-eric/" rel="nofollow">https://www.bbmri.de/ueber-gbn/bbmri-eric/</a></p></td></tr></tbody></table></div><p>                
            </p><div class="pageBreakInPdfExport">
                </div><a name="Bookmark5"></a><h1 id="Bookmark5">Einleitung</h1><a name="Bookmark6"></a><h2 id="Bookmark6">Inhalt des Dokuments</h2><p>Die vorliegende Dokumentation des CentraXX-FHIR-Custom-Exports umfasst folgende Punkte:</p><ul><li>initiale Einrichtung der Schnittstelle f&uuml;r den CentraXX-FHIR-Custom-Export</li><li>Konfiguration des Exports f&uuml;r spezifische FHIR-Projekte</li><li>Einrichtung einer Entwicklungsumgebung und Installation einer Groovy-basierten Kairos-FHIR-DSL-Bibliothek</li><li>Exemplarische Einf&uuml;hrung in die Funktionalit&auml;t der DSL als Grundlage zur Erarbeitung eigener Transformationsskripte.</li></ul><p>Zur Einf&uuml;hrung in die Nutzung der DSL werden Code-Beispiele aus bereits existierenden Beispiel-Transformationsskripten herangezogen. Dabei wird kontextuell auf die Programmiersprache 'Groovy' eingegangen, das vorliegende Dokument<span style="letter-spacing: 0.0px;">&nbsp;dient jedoch nicht dazu Grundlagen von Groovy, Prinzipien der Implementation der DSL oder die Spezifikation des HL7-FHIR-Standard zu vermitteln. An geeigneten Stellen werden weiterf&uuml;hrende Links zu den eben genannten Themen referenziert. Weiterhin beinhaltet dieses Dokument keine umfassende Dokumentation der Kairos-FHIR-DSL selbst.&nbsp;</span></p><p>Voraussetzung f&uuml;r die Nutzung</p><p>Es wird eine konfigurierte und parametrierte CentraXX-Instanz vorausgesetzt.&nbsp;Folgende Programm-Versionen wurden zur Erarbeitung der Dokumentation verwendet:</p><div class="table-wrap"><table class="relative-table wrapped confluenceTable" style="width: 31.6887%;; font-size:1.0em"><colgroup><col style="" /><col style="" /></colgroup><tbody><tr><th colspan="1" class="confluenceTh"><p>Programm</p></th><th colspan="1" class="confluenceTh"><p>Version</p></th></tr><tr><td class="confluenceTd" style="padding:0.5em"><p>CentraXX</p></td><td class="confluenceTd" style="padding:0.5em"><p><span><span class="objectBox objectBox-string">3.17.2<br /></span></span></p></td></tr><tr><td class="confluenceTd" style="padding:0.5em"><p>Kairos-FHIR-DSL-Bibliothek</p></td><td class="confluenceTd" style="padding:0.5em"><p><span><span class="objectBox objectBox-string">1.7.0</span></span></p></td></tr><tr><td class="confluenceTd" style="padding:0.5em"><p>HL7 FHIR</p></td><td class="confluenceTd" style="padding:0.5em"><p>4.0.1</p></td></tr><tr><td class="confluenceTd" style="padding:0.5em"><p>IntelliJ</p></td><td class="confluenceTd" style="padding:0.5em"><p>2020.3.2</p></td></tr><tr><td colspan="1" class="confluenceTd" style="padding:0.5em"><p>Blaze</p></td><td colspan="1" class="confluenceTd" style="padding:0.5em"><p>0.10.3</p></td></tr><tr><td colspan="1" class="confluenceTd" style="padding:0.5em"><p>Blazectl</p></td><td colspan="1" class="confluenceTd" style="padding:0.5em"><p>0.2.0</p></td></tr></tbody></table></div><a name="Bookmark7"></a><h2 id="Bookmark7">Zielgruppe</h2><p>Dieses Dokument richtet sich in erster Linie an CentraXX Nutzer mit IT-Verst&auml;ndnis, welche:</p><ul><li>die Schnittstelle verwalten</li><li>den FHIR-Export f&uuml;r Projekte konfigurieren</li><li>Transformations-Skripte erarbeiten oder bearbeiten.</li></ul><p>Grundlegende Erfahrungen in Java und/oder Groovy werden ebenso vorausgesetzt wie ein Basisverst&auml;ndnis &uuml;ber den HL7-FHIR-Standard, da dieser die Grundlage f&uuml;r die hier dokumentierte Schnittstelle ist.</p><p>                
            </p><div class="pageBreakInPdfExport">
                </div><a name="Bookmark8"></a><h2 id="Bookmark8">&Uuml;berblick &uuml;ber die Schnittstelle</h2><p><span>Der CentraXX-FHIR-Custom-Export stellt prim&auml;r einen projektspezifisch konfigurierten FHIR Export dar. Im Rahmen der Modulation des Exportverhaltens &uuml;ber ein Groovy Script werden lokal definierte CentraXX Entit&auml;ten auf die verschiedenen&nbsp;Felder einer FHIR Nachricht gemappt. Neben der vollen Kontrolle &uuml;ber die zu exportierenden Inhalte erlaubt die Schnittstelle ebenfalls eine Filterung der relevanten Patienten/Probanden. Die entstehenden FHIR Bundles k&ouml;nnen dann entweder im Filesystem persistiert werden oder an eine Ziel URL eines RESTful Service &uuml;bertragen werden.<br />Derzeit werden zwei Export-Mechanismen unterst&uuml;tzt:<br /></span></p><a name="Bookmark9"></a><h3 id="Bookmark9">Scheduled Export:</h3><p>Hierbei wird durch eine zeitliche Planung der Export f&uuml;r <strong>alle</strong>&nbsp;gefilterten Patienten gestartet.&nbsp; <span>Der Prozess f&uuml;r den Scheduled Export wird im folgenden UML-Diagramm dargestellt:</span></p><p><br /></p><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" width="500" src="img_1.png" data-image-src="/download/attachments/64291632/FHIR_Export_UML.png?version=1&amp;modificationDate=1610640768335&amp;api=v2" data-unresolved-comment-count="0" data-linked-resource-id="65897290" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="FHIR_Export_UML.png" data-base-url="http://confluence.kairosbochum.de" data-linked-resource-content-type="image/png" data-linked-resource-container-id="64291632" data-linked-resource-container-version="102" height="525" /></span></p><a name="Bookmark10"></a><h3 id="Bookmark10">Inkrementeller Export:</h3><p>Der andere Exportmechanismus wird durch eine Datenver&auml;nderung und nicht durch einen zeitlichen Trigger gestartet. Konkret bedeutet dies, dass hier nur die Patienten exportiert werden, die tats&auml;chlich ge&auml;ndert wurden. <br />Sobald Daten eines Patienten in CentraXX ge&auml;ndert werden oder ein neuer Patient angelegt wird, wird der Export f&uuml;r diesen Patienten gestartet. Der Patient muss immer noch dem projektspezifischen Patientenfilter gen&uuml;gen. Der Export wird f&uuml;r alle assoziierten Entit&auml;ten&nbsp;(Patient, Diagnosen, Verl&auml;ufe, etc.) vorgenommen. Um die Integrit&auml;t der Referenzierung nicht zu gef&auml;hrden, werden bei einer &Auml;nderung der Patientendaten immer alle Entit&auml;ten transformiert und exportiert. Der inkrementelle Export bietet somit eine effiziente M&ouml;glichkeit, um die Daten in einem FHIR-Store mit denen in CentraXX zu synchronisieren, ohne gleichbleibende Daten periodisch immer wieder zu &uuml;bertragen.</p><a name="Bookmark11"></a><h1 id="Bookmark11">Einrichtung in CentraXX</h1><a name="Bookmark12"></a><h2 id="Bookmark12">Konfiguration der centraxx-dev.properties</h2><p>Zur Nutzung des FHIR-Custom-Exports m&uuml;ssen die Export-Funktionen allgemein aktiviert werden. Zus&auml;tzlich muss das &uuml;bergeordnete Export-Mapping-Verzeichnis spezifiziert werden, in welchem die Unterordner der Projekte mit den spezifischen Konfigurations- und Mapping-Dateien liegen. <br />Die Properties in der centraxx-dev.properties beziehen sich immer auf den Applikationsserver und etwaige Pfade m&uuml;ssen auf dem Server vorhanden sein.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">interfaces.fhir.custom.export.scheduled.enable=&lt;true|false&gt;
interfaces.fhir.custom.export.incremental.enable=&lt;true|false&gt;
interfaces.fhir.custom.mapping.dir=C:/applications/centraxx-home/fhir-custom-mappings</pre>
</div></div><a name="Bookmark13"></a><h2 id="Bookmark13">Einrichtung eines Projekts am Beispiel einer Ausleitung f&uuml;r das DKTK</h2><p>Die FHIR-Ressourcen sind projektspezifisch definiert. Bei der Einrichtung von Export-Projekten f&uuml;r verschiedene FHIR-Projekte werden f&uuml;r dieselbe CentraXX-Entit&auml;t demnach auch projektspezifische Transformations-Skripte ben&ouml;tigt. Weswegen die Transformationsskripte und Konfigurationsdateien f&uuml;r jedes Projekt in einem separaten Unterverzeichnis bereitgestellt werden.&nbsp; Als Beispiel hierzu soll ein Projekt zur Transformation der CentraXX-Entit&auml;ten in FHIR-Profile des DKTK-Projekts angelegt werden. Die Profilierung der Ressourcen wurde durch das DKTK umgesetzt und wird von CXX lediglich abgebildet. Die FHIR Ressourcen sind unter <a class="external-link" href="https://simplifier.net/oncology" rel="nofollow">https://simplifier.net/oncology</a>&nbsp;definiert und dokumentiert.&nbsp;Daf&uuml;r ist ein Unterverzeichnis <strong>/dktk&nbsp;</strong>unter interfaces.fhir.custom.mapping.dir anzulegen. Auch wenn die Benamung des Unterverzeichnisses frei ist, sollten hier sprechende Namen verwendet werden. In diesem Verzeichnis sind die Groovy-Transformations-Skripte f&uuml;r dieses Projekt abzulegen. Der resultierende Pfad aus dem Beispiel oben w&uuml;rde sich somit zu: &quot;C:/applications/centraxx-home/fhir-custom-mappings/dktk&quot; ergeben.</p><p>Nach dem Anlegen eines neuen Projektverzeichnisses und einem Neustart von CentraXX wird automatisiert eine Projektkonfigurationsdatei (ProjectConfig.json) im Projektverzeichnis erzeugt. Wenn die Bedingungen des ersten Synchronisationslaufes erf&uuml;llt sind und es zu einem ersten Durchlauf der Exportroutinen kommt, wird CX zwei weitere Konfigurationsdateien erzeugen. Somit wurden insgesamt folgende drei Konfigurationsdateien erzeugt:</p><ul><li>ProjectConfig.json</li><li>ExportResourceMethodConfig.json</li><li>BundleRequestMethodConfig.json.</li></ul><a name="Bookmark14"></a><h3 id="Bookmark14"><strong>ProjectConfig.json</strong></h3><p><span><span style="color: rgb(0,51,102);">Die ProjectConfig.json</span> ist die Basis- Konfigurationsdatei f&uuml;r den FHIR-Export eines Export-Projekts. Diese Konfiguration kann nicht w&auml;hrend der Laufzeit ge&auml;ndert werden. CentraXX muss nach &Auml;nderungen dieser Datei neu gestartet werden. Die Konfigurationsdatei enth&auml;lt f&uuml;r jeden Konfigurationsparameter ein Feld &bdquo;description&ldquo;, welches die Funktion des Parameters in englischer Sprache erkl&auml;rt. Dieses Feld dient nur zur Information des Nutzers. In den folgenden Beispielen werden sehr lange Description-Strings - zur vereinfachten Darstellung - mit &quot;...&quot; abgek&uuml;rzt.</span></p><p><u>Scheduled Export</u>: Mit dieser Config wird der Scheduled Export f&uuml;r das Projekt aktiviert. Alle gefilterten CentraXX Patienten-Daten werden zum spezifizierten Zeitpunkt exportiert.</p><pre><span style="color: rgb(135,16,148);">&quot;scheduledExportEnable&quot;</span>: {<br />  <span style="color: rgb(135,16,148);">&quot;description&quot;</span>: <span style="color: rgb(6,125,23);">&quot;If true, this project will export all filtered CXX patient data with the configured FHIR resources by the specified exportInterval.&quot;</span>,<br />  <span style="color: rgb(135,16,148);">&quot;value&quot;</span>: <span style="color: rgb(0,51,179);">true<br /></span>},</pre><p><u>Inkrementeller Export</u>: Aktiviert den inkrementellen Export. Wenn Patienten-Daten in CentraXX ge&auml;ndert werden, wird der Export f&uuml;r diesen Patienten gestartet. Es werden nur Patienten ber&uuml;cksichtigt, die dem allgemeinen Patientenfilter gen&uuml;gen.</p><pre><span style="color: rgb(135,16,148);">&quot;incrementalExportEnable&quot;</span>: {<br />  <span style="color: rgb(135,16,148);">&quot;description&quot;</span>: <span style="color: rgb(6,125,23);">&quot;If true, this project will export filtered CXX patient data with the configured FHIR resources by a detected change after a centraxx transaction.&quot;</span>,<br />  <span style="color: rgb(135,16,148);">&quot;value&quot;</span>: <span style="color: rgb(0,51,179);">false<br /></span>},</pre><p><span style="color: rgb(0,0,0);"><u>Patientenfilter</u>: Dieser Filter spezifiziert, welche Patientendaten innerhalb des FHIR-Exports eingeschlossen werden. Der Filtertyp und der dazugeh&ouml;rige Filter-Wert werden hierzu spezifiziert. <br />Die folgende Filtertypen stehen zur Auswahl:</span></p><div class="table-wrap"><table class="relative-table wrapped confluenceTable" style="width: 57.4705%;; font-size:1.0em"><colgroup><col style="" /><col style="" /></colgroup><tbody><tr><th class="confluenceTh"><span style="color: rgb(0,51,102);">Filter</span></th><th class="confluenceTh">Beschreibung</th></tr><tr><td class="confluenceTd" style="padding:0.5em"><span style="color: rgb(0,0,0);">PATIENTSTUDY</span></td><td class="confluenceTd" style="padding:0.5em"><span style="color: rgb(0,0,0);">Patient geh&ouml;rt zu einer bestimmten Studie im Studienregister. Die Studie wird folgenderma&szlig;en&nbsp;spezifiziert: <br />&quot;{studyCode}${studyProfileCode}&quot;, z.B. COVID19$BASIC.</span></td></tr><tr><td class="confluenceTd" style="padding:0.5em"><p><span style="color: rgb(0,0,0);">CONSENTTYPE</span></p></td><td class="confluenceTd" style="padding:0.5em"><span style="color: rgb(0,0,0);">Patient besitzt eine Einverst&auml;ndniserkl&auml;rung eines bestimmten Typs (Code).</span></td></tr><tr><td class="confluenceTd" style="padding:0.5em"><span style="color: rgb(0,0,0);">ORGUNIT</span></td><td class="confluenceTd" style="padding:0.5em"><span style="color: rgb(0,0,0);">Patient geh&ouml;rt zu einer bestimmten CentraXX- Organisationseinheit (Code).</span></td></tr><tr><td colspan="1" class="confluenceTd" style="padding:0.5em"><p><span style="color: rgb(0,0,0);">FLEXIFLAGDEF</span></p></td><td colspan="1" class="confluenceTd" style="padding:0.5em"><span style="color: rgb(0,0,0);">Patient besitzt ein Universalattribut eines bestimmten Universalattribut-Typs (Code).</span></td></tr><tr><td colspan="1" class="confluenceTd" style="padding:0.5em"><span style="color: rgb(0,0,0);">IDTYPE</span></td><td colspan="1" class="confluenceTd" style="padding:0.5em"><span style="color: rgb(0,0,0);">Patient besitzt ID eines bestimmten ID-Typs (Code).</span></td></tr></tbody></table></div><p><span style="color: black;">Es folgt ein Beispiel zur Konfiguration eines Filters, welcher alle Patienten einschlie&szlig;t, welche eine ID des Types &bdquo;COVID-19-PATIENTID&ldquo; besitzen:</span></p><pre><span style="color: rgb(135,16,148);">&quot;patientFilterType&quot;</span>: {<br />  <span style="color: rgb(135,16,148);">&quot;description&quot;</span>: <span style="color: rgb(6,125,23);">&quot;..</span><span style="color: rgb(6,125,23);">.&quot;</span>,<br />  <span style="color: rgb(135,16,148);">&quot;value&quot;</span>: <span style="color: rgb(6,125,23);">&quot;IDTYPE&quot;<br /></span>},<br /><span style="color: rgb(135,16,148);">&quot;patientFilterValue&quot;</span>: {<br />  <span style="color: rgb(135,16,148);">&quot;description&quot;</span>: <span style="color: rgb(6,125,23);">&quot;The filter value.&quot;</span>,<br />  <span style="color: rgb(135,16,148);">&quot;value&quot;</span>: <span style="color: rgb(6,125,23);">&quot;COVID-19-PATIENTID&quot;<br /></span>},</pre><p><span style="color: rgb(0,0,0);"><u>Seitengr&ouml;&szlig;e</u>: Bestimmt die Gr&ouml;&szlig;e einer CentraXX-Abfrage und des dazugeh&ouml;rigen FHIR-Bundles. Es wird empfohlen einen kleineren Wert zu w&auml;hlen, wenn das Zielsystem ein Transaktions-System besitzt (z.B. 10 f&uuml;r CentraXX). Ist dies nicht der Fall, oder im Falle, dass ins Filesystem exportiert werden soll, so kann ein gr&ouml;&szlig;erer Wert gew&auml;hlt werden (z.B. 500).</span></p><pre><span style="color: rgb(135,16,148);">&quot;pageSize&quot;</span>: {<br />  <span style="color: rgb(135,16,148);">&quot;description&quot;</span>: <span style="color: rgb(6,125,23);">&quot;...&quot;</span>,<br />  <span style="color: rgb(135,16,148);">&quot;value&quot;</span>: <span style="color: rgb(23,80,235);">10<br /></span>},</pre><p><span style="color: rgb(0,51,102);"><span style="color: rgb(0,0,0);"><u>Exportzeitraum</u>: Legt den Zeitraum des FHIR-Exportvorgangs fest. Die Zeitangabe erfolgt mittels eines sechsstelligen Chron-Ausdrucks. Mit der Standardkonfiguration erfolgt der Export jeden Tag um 12 Uhr. Hierbei sind</span> <a class="external-link" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/scheduling/support/CronExpression.html" rel="nofollow">Cron-Ausdr&uuml;cke von Spring</a> <span style="color: rgb(0,0,0);">zu verwenden.</span></span></p><p><span style="color: rgb(0,0,0);">Als Beispiel die Standardkonfiguration:</span></p><pre><span style="color: rgb(135,16,148);">&quot;exportInterval&quot;</span>: {<br />  <span style="color: rgb(135,16,148);">&quot;description&quot;</span>: <span style="color: rgb(6,125,23);">&quot;Sets the export cron interval. Default is once a day.&quot;</span>,<br />  <span style="color: rgb(135,16,148);">&quot;value&quot;</span>: <span style="color: rgb(6,125,23);">&quot;0 0 12 * * *&quot;<br /></span>},</pre><p><span style="color: rgb(0,0,0);"><u>Export ins Filesystem</u>: Die FHIR-Daten k&ouml;nnen in das lokale Filesystem exportiert werden. Dazu muss der Export mit folgender Property aktiviert werden:</span></p><pre><span style="color: rgb(135,16,148);">&quot;exportToFileSystem&quot;</span>: {<br />  <span style="color: rgb(135,16,148);">&quot;description&quot;</span>: <span style="color: rgb(6,125,23);">&quot;If true, the scheduler will export to the specified file system exportFolder.&quot;</span>,<br />  <span style="color: rgb(135,16,148);">&quot;value&quot;</span>: <span style="color: rgb(0,51,179);">true<br /></span>},</pre><p><span style="color: rgb(0,0,0);">Zudem muss das Zielverzeichnis f&uuml;r den Export angegeben werden. Existiert das angegebene Verzeichnis nicht, wird es von CentraXX neu angelegt:</span></p><pre><span style="color: rgb(135,16,148);">&quot;exportFolder&quot;</span>: {<br />  <span style="color: rgb(135,16,148);">&quot;value&quot;</span>: <span style="color: rgb(6,125,23);">&quot;C:/centraxx-home/fhir-custom-export&quot;<br /></span>},</pre><p><span style="color: rgb(0,0,0);"><u>Export an URL</u>: Die FHIR-Ressourcen k&ouml;nnen per HTTP an externe Zielsysteme transferiert werden. Diese Export-Funktion wird mit folgender Property aktiviert:</span></p><pre><span style="color: rgb(135,16,148);">&quot;uploadToUrl&quot;</span>: {<br />  <span style="color: rgb(135,16,148);">&quot;description&quot;</span>: <span style="color: rgb(6,125,23);">&quot;If true, the scheduler will export to the specified  uploadUrl REST endpoint.&quot;</span>,<br />  <span style="color: rgb(135,16,148);">&quot;value&quot;</span>: <span style="color: rgb(0,51,179);">false<br /></span>},</pre><p><span style="color: rgb(0,0,0);">Des Weiteren muss die URL des Zielsystems angegeben werden. Diese ist der Endpunkt einer Bundle-Ressource in einem FHIR-Store, wie Blaze oder CentraXX:</span></p><pre><span style="color: rgb(135,16,148);">&quot;uploadUrl&quot;</span>: {<br />  <span style="color: rgb(135,16,148);">&quot;value&quot;</span>: <span style="color: rgb(6,125,23);">&quot;http://localhost:9090/fhir&quot;<br /></span>},</pre><p><span style="color: rgb(0,51,102);"><span style="color: rgb(0,0,0);">Zur HTTP-Authentifizierung am Ziel-Server wird</span> <a class="external-link" href="https://de.wikipedia.org/wiki/HTTP-Authentifizierung" rel="nofollow">BasicAuthentication</a> <span style="color: rgb(0,0,0);">verwendet. Nutzername und Passwort werden folgenderma&szlig;en konfiguriert</span></span><span style="color: rgb(0,0,0);">:</span></p><pre><span style="color: rgb(135,16,148);">&quot;uploadUser&quot;</span>: {<br />  <span style="color: rgb(135,16,148);">&quot;description&quot;</span>: <span style="color: rgb(6,125,23);">&quot;BasicAuth User name in the target system.&quot;</span>,<br />  <span style="color: rgb(135,16,148);">&quot;value&quot;</span>: <span style="color: rgb(6,125,23);">&quot;admin&quot;<br /></span>},<br /><span style="color: rgb(135,16,148);">&quot;uploadPassword&quot;</span>: {<br />  <span style="color: rgb(135,16,148);">&quot;description&quot;</span>: <span style="color: rgb(6,125,23);">&quot;BasicAuth Password in the target system.&quot;</span>,<br />  <span style="color: rgb(135,16,148);">&quot;value&quot;</span>: <span style="color: rgb(6,125,23);">&quot;admin&quot;<br /></span>},</pre><p><span style="color: rgb(0,0,0);">Verlangt das System keine Authentifizierung, werden die angegeben Daten f&uuml;r Nutzername und Passwort ignoriert.&nbsp; </span></p><p><span style="color: rgb(0,51,102);"><span style="color: rgb(0,0,0);">Weiterf&uuml;hrend kann im Falle von</span> &quot;<span style="color: rgb(152,118,170);">uploadToUrl = true<span style="color: rgb(0,51,102);">&quot; </span></span><span style="color: rgb(0,0,0);">die Nutzung einer Validierung der HTTPS Zieladresse konfiguriert werden. Mit folgender Konfiguration wird spezifiziert, ob allen Zertifikaten vertraut werden kann:</span><br /></span></p><pre><span style="color: rgb(135,16,148);">&quot;sslTrustAllEnable&quot;</span>: {<br />  <span style="color: rgb(135,16,148);">&quot;description&quot;</span>: <span style="color: rgb(6,125,23);">&quot;If true, all ssl/tls certificates are trusted, otherwise the the default java store is used for SSL/TLS verification.&quot;</span>,<br />  <span style="color: rgb(135,16,148);">&quot;value&quot;</span>: <span style="color: rgb(0,51,179);">false<br /></span>},</pre><p>Ist die Option auf &quot;false&quot; gesetzt, wird der Standard-Truststore (Java TrustStore) verwendet. Im Falle, dass auch beispielsweise system-spezifischen Zertifikaten vertraut werden kann, so k&ouml;nnen diese in einem benutzerdefinierten Truststore abgelegt werden. Als Truststore ist eine <a class="external-link" href="https://docs.oracle.com/cd/E19509-01/820-3503/6nf1il6er/index.html" rel="nofollow">Java KeyStore</a>-Datei (.jks) zu verwenden. Zudem sind der Pfad der Truststore-Datei im Dateisystem und das Passwort zu konfigurieren:</p><pre><span style="color: rgb(135,16,148);">&quot;trustStoreEnable&quot;</span>: {<br />  <span style="color: rgb(135,16,148);">&quot;description&quot;</span>: <span style="color: rgb(6,125,23);">&quot;...&quot;</span>,<br />  <span style="color: rgb(135,16,148);">&quot;value&quot;</span>: <span style="color: rgb(0,51,179);">false<br /></span>},</pre><pre><span style="color: rgb(135,16,148);">&quot;trustStore&quot;</span>: {<br />  <span style="color: rgb(135,16,148);">&quot;value&quot;</span>: <span style="color: rgb(6,125,23);">&quot;C:/centraxx-home/</span><span style="color: rgb(6,125,23);">fhir-custom-truststore</span><span style="color: rgb(6,125,23);">.jks&quot;<br /></span>},</pre><pre><span style="color: rgb(135,16,148);">&quot;trustStorePassword&quot;</span>: {<br />  <span style="color: rgb(135,16,148);">&quot;value&quot;</span>: <span style="color: rgb(6,125,23);">&quot;changeit&quot;<br /></span>},</pre><p>F&uuml;r den FHIR-Export k&ouml;nnen au&szlig;erdem das Login f&uuml;r die Anfragen und Antworten der HTTP-Requests konfiguriert werden. Das kann hilfreich zur Initialisierung und zum Testen sein. Wird bspw. ein neuer Export konfiguriert, welcher per HTTP an einen FHIR-Store ausgeweitet wird, so k&ouml;nnen die gesendeten FHIR-Ressourcen und die HTTP-Antworten des Zielservers eingesehen werden. Die Messages werden standardm&auml;&szlig;ig innerhalb des Serverlogs geloggt.&nbsp;Mit folgender Option kann die HTTP-Message-Body, sprich das gesendete FHIR-Bundle, geloggt werden. &nbsp;Die Konfiguration &quot;prettyPrintEnable&quot; bietet hierbei die Option diese Nachrichten f&uuml;r den Nutzer leserlich strukturiert zu loggen.&nbsp;Hierbei gilt es zu beachten, dass die Aktivierung dieser Optionen bei einer hohen Anzahl von auszuleitenden Entit&auml;ten, den Serverlog schnell f&uuml;llen werden.</p><pre><span style="color: rgb(135,16,148);">&quot;prettyPrintEnable&quot;</span>: {<br />  <span style="color: rgb(135,16,148);">&quot;description&quot;</span>: <span style="color: rgb(6,125,23);">&quot;Print style the HTTP message body.&quot;</span>,<br />  <span style="color: rgb(135,16,148);">&quot;value&quot;</span>: <span style="color: rgb(0,51,179);">false<br /></span>},<br /><span style="color: rgb(135,16,148);">&quot;fhirMessageLoggingEnable&quot;</span>: {<br />  <span style="color: rgb(135,16,148);">&quot;description&quot;</span>: <span style="color: rgb(6,125,23);">&quot;If true, HTTP message requests are logged in CentraXX separately.&quot;</span>,<br />  <span style="color: rgb(135,16,148);">&quot;value&quot;</span>: <span style="color: rgb(0,51,179);">false<br /></span>},</pre><p>Die HTTP-Antwort des Zielservers kann ebenfalls geloggt werden. Dazu muss folgende Option aktiviert sein:</p><pre><span style="color: rgb(135,16,148);">&quot;fhirResponseLoggingEnable&quot;</span>: {<br />  <span style="color: rgb(135,16,148);">&quot;description&quot;</span>: <span style="color: rgb(6,125,23);">&quot;If true, HTTP message responses are logged in CentraXX separately.&quot;</span>,<br />  <span style="color: rgb(135,16,148);">&quot;value&quot;</span>: <span style="color: rgb(0,51,179);">false<br /></span>},</pre><p><span>FHIR- Ressourcen werden Bundle-weise exportiert und in das Zielsystem eingeschleust. Ein solches Bundle kann bspw. Daten von f&uuml;nf Exemplaren der FHIR-Ressource 'Patient' enthalten. Bei der Verarbeitung des HTTP-Request k&ouml;nnten z.B. vier der Patienten aus der Bundle-Ressource erfolgreich importiert werden, jedoch der Import f&uuml;r einen fehlschlagen. In diesem Fall wird jedoch trotzdem eine positive HTTP-Antwort (200 OK) erzeugt. Um den Import jeder einzelnen im Bundle enthaltenen FHIR-Ressource zu validieren, muss somit die Antwort geparst und jeder Eintrag gegen die zugeh&ouml;rige FHIR-Ressource validiert werden. Diese Validierung wird mit folgender Konfiguration aktiviert:</span></p><p><span style="color: rgb(135,16,148);">&quot;fhirResponseValidationEnable&quot;</span>: {<br /><span style="color: rgb(135,16,148);">&quot;description&quot;</span>: <span style="color: rgb(6,125,23);">&quot;...&quot;</span>,<br /><span style="color: rgb(135,16,148);">&quot;value&quot;</span>: <span style="color: rgb(0,51,179);">false<br /></span>}<br /><br /></p><div class="confluence-information-macro confluence-information-macro-note"><span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span><div class="confluence-information-macro-body">&Auml;nderungen an der ProjectConfig.json werden ausschliesslich beim CentraXX Neustart eingelesen. Somit werden auch &Auml;nderungen am Scheduling oder an den Filtern nur dann wirksam, wenn CentraXX neu gestartet wird.</div></div><a name="Bookmark15"></a><h3 id="Bookmark15">ExportResourceMappingConfig.json</h3><p><span>Diese Konfiguration verkn&uuml;pft eine CentraXX-Entit&auml;t mit einer FHIR-Ressource &uuml;ber ein Groovy-Transformations-Skript (groovy-Mapping). Die gleiche CentraXX-Entit&auml;t kann so konfiguriert werden, dass sie &uuml;ber verschiedene Transformations-Skripte auf die gleiche FHIR-Ressource abgebildet werden. Diese Konfiguration kann w&auml;hrend der Laufzeit ge&auml;ndert werden und ben&ouml;tigt keinen Neustart von CentraXX. Die Reihenfolge der Mappings ist wichtig, wenn das Zielsystem die referentielle Integrit&auml;t pr&uuml;ft (z.B. Blaze Store).&nbsp;</span>Folgend ein Besipiel f&uuml;r einen Eintrag in ExportResourceMappingConfig.json:</p><pre>{<br />  <span style="color: rgb(152,118,170);">&quot;selectFromCxxEntity&quot;</span><span style="color: rgb(204,120,50);">: </span><span style="color: rgb(106,135,89);">&quot;ORGANIZATION_UNIT&quot;</span><span style="color: rgb(204,120,50);">,<br /></span><span style="color: rgb(204,120,50);">  </span><span style="color: rgb(152,118,170);">&quot;transformByTemplate&quot;</span><span style="color: rgb(204,120,50);">: </span><span style="color: rgb(106,135,89);">&quot;organisation&quot;</span><span style="color: rgb(204,120,50);">,<br /></span><span style="color: rgb(204,120,50);">  </span><span style="color: rgb(152,118,170);">&quot;exportToFhirResource&quot;</span><span style="color: rgb(204,120,50);">: </span><span style="color: rgb(106,135,89);">&quot;Organization&quot;<br /></span>}<span style="color: rgb(204,120,50);">,<br /></span></pre><p>Hier werden demnach Daten der CentraXX-Entit&auml;t &quot;ORGANIZATION_UNIT&quot; mittels der Transformationsvorlage &quot;organisation&quot; auf die FHIR-Ressource &quot;Organization&quot; abgebildet. Das korrespondierende Transformations-Skript ist dann das Groovy-Skript das nach dem oben eingef&uuml;hrten Beispiel unter &quot;C:\applications\centraxx-home\<span style="color: rgb(0,0,0);">fhir-custom-mappings\dktk</span>\organisation.groovy&quot; liegt.&nbsp;</p><div class="confluence-information-macro confluence-information-macro-note"><span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><u>Hinweis</u>: Die Eintr&auml;ge in der Standard-Version (bei Projekt-Erstellung von CentraXX erzeugt), spezifiziert zugleich auch alle CentraXX-Entit&auml;ten f&uuml;r die derzeit Ausleitungen m&ouml;glich sind!</div></div><a name="Bookmark16"></a><h3 id="Bookmark16">ResourceBundleExportConfig.json</h3><p>F&uuml;r den Export der FHIR-Ressourcen an eine Ziel-URL, k&ouml;nnen verschiedene HTTP-Methoden f&uuml;r unterschiedliche FHIR-Ressourcen-Typen verwendet werden. Welche HTTP-Methoden f&uuml;r welchen Ressourcen-Typ zu verwenden ist, h&auml;ngt vom Zielsystem ab. In der ResourceBundleExportConfig.json Konfigurationsdatei wird den einzelnen FHIR-Ressourcen-Typen eine HTTP-Methode zugeordnet. Diese Konfiguration kann w&auml;hrend der Laufzeit ge&auml;ndert werden.</p><p>Die Konfiguration k&ouml;nnte wie folgt aussehen:</p><pre>{<br />  <span style="color: rgb(152,118,170);">&quot;description&quot;</span><span style="color: rgb(204,120,50);">: </span><span style="color: rgb(106,135,89);">&quot;...&quot;</span><span style="color: rgb(204,120,50);">,<br /></span><span style="color: rgb(204,120,50);">  </span><span style="color: rgb(152,118,170);">&quot;resourceTypeToHttpMethod&quot;</span><span style="color: rgb(204,120,50);">: </span>{<br />    <span style="color: rgb(152,118,170);">&quot;Patient&quot;</span><span style="color: rgb(204,120,50);">: </span><span style="color: rgb(106,135,89);">&quot;PUT&quot;</span><span style="color: rgb(204,120,50);">,<br /></span><span style="color: rgb(204,120,50);">    </span><span style="color: rgb(152,118,170);">&quot;Specimen&quot;</span><span style="color: rgb(204,120,50);">: </span><span style="color: rgb(106,135,89);">&quot;PUT&quot;</span><span style="color: rgb(204,120,50);">,<br /></span><span style="color: rgb(204,120,50);">    </span><span style="color: rgb(152,118,170);">&quot;Condition&quot;</span><span style="color: rgb(204,120,50);">: </span><span style="color: rgb(106,135,89);">&quot;PUT&quot;</span><span style="color: rgb(204,120,50);">,<br /></span><span style="color: rgb(204,120,50);">    </span><span style="color: rgb(152,118,170);">&quot;Encounter&quot;</span><span style="color: rgb(204,120,50);">: </span><span style="color: rgb(106,135,89);">&quot;PUT&quot;</span><span style="color: rgb(204,120,50);">,<br /></span><span style="color: rgb(204,120,50);">    </span><span style="color: rgb(152,118,170);">&quot;Observation&quot;</span><span style="color: rgb(204,120,50);">: </span><span style="color: rgb(106,135,89);">&quot;PUT&quot;</span><span style="color: rgb(204,120,50);">,<br /></span><span style="color: rgb(204,120,50);">    </span><span style="color: rgb(152,118,170);">&quot;Procedure&quot;</span><span style="color: rgb(204,120,50);">: </span><span style="color: rgb(106,135,89);">&quot;PUT&quot;</span><span style="color: rgb(204,120,50);">,<br /></span><span style="color: rgb(204,120,50);">    </span><span style="color: rgb(152,118,170);">&quot;Organization&quot;</span><span style="color: rgb(204,120,50);">: </span><span style="color: rgb(106,135,89);">&quot;PUT&quot;</span><span style="color: rgb(204,120,50);">,<br /></span><span style="color: rgb(204,120,50);">    </span><span style="color: rgb(152,118,170);">&quot;MedicationStatement&quot;</span><span style="color: rgb(204,120,50);">: </span><span style="color: rgb(106,135,89);">&quot;PUT&quot;</span><span style="color: rgb(204,120,50);">,<br /></span><span style="color: rgb(204,120,50);">    </span><span style="color: rgb(152,118,170);">&quot;ClinicalImpression&quot;</span><span style="color: rgb(204,120,50);">: </span><span style="color: rgb(106,135,89);">&quot;PUT&quot;<br /></span><span style="color: rgb(106,135,89);">  </span>}<br />}</pre><p><br /></p><div class="confluence-information-macro confluence-information-macro-note"><span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><p>Ist ein Ressourcen-Typ nicht konfiguriert, so wird &quot;PUT&quot; als Voreinstellung verwendet. CentraXX nutzt &quot;PUT&quot; zum Anlegen, oder Updaten &uuml;ber die &quot;logical id&quot; einer FHIR-Ressource. &quot;POST&quot; wird zum Anlegen, oder Updaten &uuml;ber den &quot;natural identifier&quot; (nur Patient, Specimen) genutzt.</p></div></div><a name="Bookmark17"></a><h1 id="Bookmark17">Nutzung der Groovy-DSL-Bibliothek</h1><a name="Bookmark18"></a><h2 id="Bookmark18">Einleitung/&Uuml;berblick</h2><p><span>DSL steht f&uuml;r &quot;<u>d</u>omain <u>s</u>pecific <u>l</u>anguage&quot;. Die DSL stellt eine intuitive benutzbare Sprache dar, um Probleme einer spezifischen Dom&auml;ne l&ouml;sen zu k&ouml;nnen. Die Kairos-FHIR-DSL wurde mit dem Ziel entwickelt, m&ouml;glichst einfach Transformation-Skripte zu schreiben, mit denen CentraXX-Entit&auml;ten auf benutzerspezifische FHIR-Profile abgebildet werden k&ouml;nnen. Somit wird ein standardisierter Datenaustausch zwischen CentraXX und anderen FHIR-basierten Systemen erm&ouml;glicht. Die Kairos-FHIR-DSL ist in der Programmiersprache <a class="external-link" href="https://groovy-lang.org/" rel="nofollow">Groovy</a> realisiert. Dementsprechend sind auch die Transformation-Skripte in Groovy zu schreiben. Um mit der DSL arbeiten zu k&ouml;nnen sind grundlegende Kenntnisse von Groovy/Java vorauszusetzen.</span></p><p><span>Beispiel-Skripte f&uuml;r die Transformation von CentraXX-Entit&auml;ten zu FHIR-Profilen k&ouml;nnen in Form eines&nbsp;Beispielprojekte heruntergeladen werden. Ausschnitte aus diesen Skripten werden im weiteren Verlauf der vorliegenden Dokumentation exemplarisch erl&auml;utert. <br />F&uuml;r folgende FHIR-Projekte werden Beispiel-Skripte zur Verf&uuml;gung gestellt:</span></p><ul><li><a class="external-link" href="https://simplifier.net/oncology" rel="nofollow">DKTK</a></li><li><a class="external-link" href="https://simplifier.net/BBMRI.de" rel="nofollow">BBMRI</a></li><li>CentraXX zu CentraXX</li></ul><p><span>Die Kairos-FHIR-DSL-Bibliothek ist im&nbsp;Beispielprojekt bereits eingebunden. Selbstverst&auml;ndlich kann sie aber auch in eigene Groovy-Projekte eingebunden werden. Zum Erstellen und Editieren der Groovy-Skripte unter zur Hilfenahme von Codecompletion und Syntaxhighlighting werden entsprechende IDE Umgebungen ben&ouml;tigt. Der Download und die Installation aller ben&ouml;tigten Programme werden folgend beschrieben.</span></p><a name="Bookmark19"></a><h2 id="Bookmark19">Voraussetzungen zur Nutzung der Kairos-FHIR-DSL Bibliothek und des Beispielprojekts</h2><ul><li><p>IDE mit Maven und Groovy Support, z.B. IDEA IntelliJ, Eclipse, etc.</p></li></ul><p>Um die Groovy-Transformationsskripte zu erarbeiten, wird eine Entwicklungsumgebung genutzt. Im Folgenden wird die Einrichtung mit IDEA IntelliJ beschrieben. Die derzeit kostenfreie Community-Edition ist hierf&uuml;r ausreichend. <br />Den Installer k&ouml;nnen Sie auf der IntelliJ Webseite herunterladen (<a class="external-link" href="https://www.jetbrains.com/idea/" rel="nofollow">https://www.jetbrains.com/idea/</a>)</p><ul><li><p>Adopt-JDK 1.8 (<span style="letter-spacing: 0.0px;">Zur Nutzung der FHIR-Bibliothek wird derzeit ein Java Development Kit 8 ben&ouml;tigt. W&auml;hlen Sie bei der Installation &quot;JAVA_HOME Variable konfigurieren&quot; aus.)</span></p></li></ul><ul><li><p>Maven&nbsp;</p><p><span style="letter-spacing: 0.0px;">IntelliJ selbst&nbsp;kommt mit einem vorinstallierten Maven. Damit Maven &uuml;ber die Kommandozeile genutzt werden kann, was zur Installation der Kairos-FHIR-DSL Bibliothek f&uuml;r eigene Groovy-Projekte sehr hilfreich ist, muss es zum &quot;Path&quot; hinzugef&uuml;gt werden. F&uuml;gen Sie dazu der Systemvariable &quot;Path&quot; den Pfad &quot;[IntelliJ]\plugins\maven\lib\maven3\bin&quot; hinzu.&nbsp;</span><span style="letter-spacing: 0.0px;">Es kann auch ein eigenes Maven installiert werden. Maven kann unter dem folgenden Link heruntergeladen werden: </span><a class="external-link" href="https://maven.apache.org/download.cgi" rel="nofollow" style="letter-spacing: 0.0px;">https://maven.apache.org/download.cgi</a>&nbsp;.&nbsp;<span style="letter-spacing: 0.0px;">Maven wird nach folgender Anleitung installiert: </span><a class="external-link" href="https://maven.apache.org/install.html" rel="nofollow" style="letter-spacing: 0.0px;">https://maven.apache.org/install.html</a><span style="letter-spacing: 0.0px;">.&nbsp;<br /></span><u style="letter-spacing: 0.0px;">Konfiguration eines benutzerspezifischen Maven:<br /></u><span style="letter-spacing: 0.0px;">Im Falle, dass nicht das Maven verwendet werden soll, welches mit IntelliJ vorinstalliert wird, kann dieses in IntelliJ einfach ge&auml;ndert werden. Dies l&auml;sst sich unter </span><span style="letter-spacing: 0.0px;color: rgb(0,51,102);">File &rarr; Settings &rarr; Build, Execution, Deployment &rarr; Build Tools &rarr; Maven</span><span style="letter-spacing: 0.0px;">, konfigurieren. An dieser Stelle muss der &quot;maven home path&quot; auf &quot;[custom-maven]/bin&quot; gesetzt werden.<br /></span><u style="letter-spacing: 0.0px;">Konfiguration des JDK 8 als Projekt-JDK:<br /></u><span style="letter-spacing: 0.0px;">Um das ben&ouml;tigte JDK 8 f&uuml;r das Projekt zu nutzen, muss dieses in intelliJ konfiguriert werden. Gehen Sie dazu unter </span><span style="letter-spacing: 0.0px;color: rgb(0,0,128);">File &rarr; Project Structure... &rarr; Project</span><span style="letter-spacing: 0.0px;"> und setzen Sie hier unter &quot;Project SDK&quot; den Pfad auf das Adopt-JDK 8. Wenn der Standard-Pfad bei der Installation nicht ge&auml;ndert wurde, dann sollte &quot;C:\Program Files\AdoptOpenJDK\jdk-8.0.275.1-hotspot&quot; gew&auml;hlt werden.</span></p></li></ul><a name="Bookmark20"></a><h2 id="Bookmark20">Installation des FHIR-Beispielprojekts</h2><p>Es existiert ein Beispiel-Projekt, welches Groovy-Mappings f&uuml;r verschiedene Projekte bereith&auml;lt. Diese umfassen momentan Mappings f&uuml;r die Projekte DKTK, BBMRI (GBA/GBN) und CXX (CentraXX zu CentraXX-Synchronisation per FHIR). Dieses Projekt wird auf <a class="external-link" href="https://github.com/kairos-fhir/kairos-fhir-dsl-mapping-example" rel="nofollow">Github</a> verwaltet. Der aktuelle Release kann ebenfalls von Github heruntergeladen werden. Gehen Sie dazu auf folgende <a class="external-link" href="https://github.com/kairos-fhir/kairos-fhir-dsl-mapping-example/releases" rel="nofollow">Seite</a>. Hier sehen Sie eine Liste mit allen Releases. Downloaden Sie den Source Code des neusten Releases und entpacken Sie die heruntergeladene Zip-Datei in das Verzeichnis, in dem Ihr Projekt liegen soll.&nbsp; Nun kann das Projekt in IntelliJ ge&ouml;ffnet werden. Gehen Sie dazu unter <span style="color: rgb(0,0,128);">File&nbsp;&rarr; New&nbsp;&rarr; Project from Existing Sources...</span> und geben Sie den Pfad [kairos-fhir-mapping-example]/pom.xml an und erstellen Sie das Projekt. Damit Maven die Kairos-FHIR-DSL-Bibliothek, die auch auf Github bereitsteht, ins Projekt einbeziehen kann, muss die &quot;settings.xml&quot; Datei konfiguriert werden. Dazu gehen Sie unter <span style="color: rgb(0,0,128);">File&nbsp;&rarr; Settings&nbsp;&rarr; Build, Execution, Deployment&nbsp; &rarr; Build Tools</span> und klicken&nbsp;&quot;Maven&quot;. Im ge&ouml;ffneten Fenster setzen Sie bei &quot;User settings file&quot; im K&auml;stchen &quot;Override&quot; den Haken und w&auml;hlen dort folgenden Pfad aus: [Projekt-Root]/settings.xml.&nbsp;Falls Sie ein eigenes Maven im Projekt verwenden wollen, konfigurieren Sie dieses im Feld &quot;Maven home path&quot;. Klicken Sie &quot;Apply&quot; und dann &quot;Ok&quot;. Gehen Sie ins in Maven-Fenster (rechts) unter <span style="color: rgb(0,0,128);">[Projektname] &rarr; Lifecycle &rarr; Install</span> oder f&uuml;hren Sie <span style="color: rgb(0,0,128);">$ mvn install -s &lt;path to settings.xml&gt;</span> im Terminal aus. Nachdem dieser Vorgang abgeschlossen ist, klicken Sie im Maven-Fenster oben links den &quot;Reload All Maven Projects&quot;-Button, damit maven alle notwendigen Plugins l&auml;dt. Gegebenenfalls muss noch das Projekt-JDK, wie oben beschrieben, konfiguriert werden.</p><a name="Bookmark21"></a><h2 id="Bookmark21">Installation der FHIR-DSL-Bibliothek</h2><p><span style="color: rgb(255,0,0);"><span style="color: rgb(0,51,102);">Die Kairos-FHIR-DSL-Bibliothek wird mittels Maven &uuml;ber Github installiert. Erstellen Sie dazu</span></span> ein neues Projekt in IntelliJ. Im Dialog muss links Groovy ausgew&auml;hlt werden. Im n&auml;chsten Fenster wird das Projektverzeichnis konfiguriert. Nachdem das Projekt initialisiert wurde, muss Maven als Framework hinzugef&uuml;gt werden. Dazu rechtsklicken Sie im Projekt-Fenster das Projektverzeichnis-Root-Element und w&auml;hlen &quot;Add Framework Support...&quot;.&nbsp; Im neuen Fenster setzen Sie den Haken bei &quot;Maven&quot; und best&auml;tigen die Eingabe mit &quot;OK&quot;. Es wird eine &quot;pom.xml&quot; Datei erstellt. Innerhalb dieser m&uuml;ssen folgende Eintr&auml;ge hinzugef&uuml;gt werden, sodass die Kairos-FHIR-DSL-Bibliothek in das Projekt eingebunden werden kann:</p><pre><span style="color: rgb(232,191,106);">&lt;dependencies&gt;<br /></span><span style="color: rgb(232,191,106);">    &lt;dependency&gt;<br /></span><span style="color: rgb(232,191,106);">        &lt;groupId&gt;</span>de.kairos<span style="color: rgb(232,191,106);">&lt;/groupId&gt;<br /></span><span style="color: rgb(232,191,106);">        &lt;artifactId&gt;</span>kairos-fhir-dsl<span style="color: rgb(232,191,106);">&lt;/artifactId&gt;<br /></span><span style="color: rgb(232,191,106);">        &lt;version&gt;</span>1.6.0<span style="color: rgb(232,191,106);">&lt;/version&gt;<br /></span><span style="color: rgb(232,191,106);">    &lt;/dependency&gt;<br /></span><span style="color: rgb(232,191,106);">&lt;/dependencies&gt;<br /></span><span style="color: rgb(232,191,106);"><br /></span><span style="color: rgb(232,191,106);">&lt;repositories&gt;<br /></span><span style="color: rgb(232,191,106);">    &lt;repository&gt;<br /></span><span style="color: rgb(232,191,106);">        &lt;id&gt;</span>github-kairos-fhir<span style="color: rgb(232,191,106);">&lt;/id&gt;<br /></span><span style="color: rgb(232,191,106);">        &lt;name&gt;</span>GitHub kairos-fhir Apache Maven Packages<span style="color: rgb(232,191,106);">&lt;/name&gt;<br /></span><span style="color: rgb(232,191,106);">        &lt;url&gt;</span>https://maven.pkg.github.com/kairos-fhir/kairos-fhir-dsl-mapping-example<span style="color: rgb(232,191,106);">&lt;/url&gt;<br /></span><span style="color: rgb(232,191,106);"> &lt;/repository&gt;<br /></span><span style="color: rgb(232,191,106);">&lt;/repositories&gt;</span></pre><p>Der obere Eintrag spezifiziert die Dependency und der untere das Repository, wo diese zu finden ist. Github erfordert bislang f&uuml;r den automatischen Dependeny-Download per Maven immer eine Authentifizierung &uuml;ber einen Access-Token. Um die Arbeit zu erleichtern wurde ein allgemeiner Access-Token im <a class="external-link" href="https://github.com/kairos-fhir/kairos-fhir-dsl-mapping-example" rel="nofollow">Github-Projekt</a> als &quot;settings.xml&quot; mit ver&ouml;ffentlicht. Legen Sie sich in Ihrem IntelliJ-Projekt ebenfalls eine eigene Settings-XML-Datei an und f&uuml;gen Sie den Datei-Inhalt aus Github ein. <span style="color: rgb(122,134,154);"><span style="color: rgb(0,51,102);">Gehen Sie nun unter <span style="color: rgb(0,0,128);">File&nbsp;&rarr; Settings&nbsp;&rarr; Build, Execution, Deployment&nbsp; &rarr; Build Tools</span></span></span> und klicken&nbsp;&quot;Maven&quot;. Im ge&ouml;ffneten Fenster setzen Sie bei &quot;User settings file&quot; im K&auml;stchen &quot;Override&quot; den Haken und w&auml;hlen den Pfad zu der eben erstellten XML-Datei aus. Falls Sie ein eigenes Maven im Projekt verwenden wollen, konfigurieren Sie dieses im Feld &quot;Maven home path&quot;. Klicken Sie &quot;Apply&quot; und dann &quot;Ok&quot;. Nun gehen Sie rechts im Maven-Fenster und w&auml;hlen <span style="color: rgb(0,0,128);">[Projektname] &rarr; Lifecycle &rarr; Install</span> oder f&uuml;hren sie <span style="color: rgb(0,0,128);">$ mvn install&nbsp; -s &lt;path to custom settings xml&gt; </span>im IntelliJ-Terminal aus.</p><a name="Bookmark22"></a><h2 id="Bookmark22">Verwendung der DSL-Bibliothek zur Erstellung von Transformations-Skripten</h2><a name="Bookmark23"></a><h3 id="Bookmark23">Allgemeines</h3><p>Groovy bietet mit Closures ein Sprachelement, dass f&uuml;r die Entwicklung einer DSL ma&szlig;geblich ist. Closures sind Code-Bl&ouml;cke, die in Groovy als Klasse behandelt werden und damit auch als Argumente an Methoden &uuml;bergeben werden k&ouml;nnen. In Closures selbst k&ouml;nnen wiederum Methoden aufgerufen werden. Dies wird genutzt, um eine intuitive Syntax zur Abbildung von FHIR-Profilen zu bieten. Um bei Interesse Groovy-Closures und -Delegations besser verstehen zu k&ouml;nnen, wird die <a class="external-link" href="https://groovy-lang.org/closures.html#_delegation_strategy" rel="nofollow">Groovy-Dokumentation</a> des Apache Projekts empfohlen.</p><p>&Uuml;ber die Delegations-Strategie kann bestimmt werden, welche Methoden in einem Closure aufgerufen werden k&ouml;nnen. Beim Aufruf einer solchen Methode, wird zur Laufzeit versucht die entsprechenden Implementationen der im Closure aufgerufenen Methode &uuml;ber den Delegations-Mechanismus zu finden. Um als Nutzer die DSL verwenden zu k&ouml;nnen, wird die Information ben&ouml;tigt, welche Methoden in welchen Closures aufgerufen werden k&ouml;nnen. Dies wird bei der Entwicklung der DSL in Groovy, mittels Annotationen realisiert. Dadurch wird eine Auto-Code-Vervollst&auml;ndigung in der Entwicklungsumgebung erm&ouml;glicht.</p><a name="Bookmark24"></a><h3 id="Bookmark24">Zusammenbau der FHIR Nachricht mit Groovy Closures</h3><p>Im Folgenden soll das Prinzip des Closures und weiterer Groovy-Spezifit&auml;ten aufgef&uuml;hrt werden, die zur Erstellung von Transformations-Skripten genutzt werden k&ouml;nnen. Dazu wird das Groovy Skript &quot;patient.groovy&quot; betrachtet, dass im Beispielprojekt unter \src\main\java\projects\dktk_with_jpa_navigation\patient.groovy vorzufinden ist. Dieses Skript bildet die CentraXX-Entit&auml;t PatientMasterDataAnonymous auf das <a class="external-link" href="https://simplifier.net/oncology/patientenpseudonym" rel="nofollow">DKTK FHIR-Profil &quot;patient&quot;</a> ab.</p><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image confluence-content-image-border" alt="Fhir-Profil f&uuml;r pseudonymisierten Patient des DKTK-Projekts" height="399" width="390" src="img_2.jpg" data-image-src="/download/attachments/64291632/dktk-patient-fhir-profile.jpg?version=1&amp;modificationDate=1609848738713&amp;api=v2" data-unresolved-comment-count="0" data-linked-resource-id="65896672" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="dktk-patient-fhir-profile.jpg" data-base-url="http://confluence.kairosbochum.de" data-linked-resource-content-type="image/jpeg" data-linked-resource-container-id="64291632" data-linked-resource-container-version="102" title="Fhir-Profil f&uuml;r pseudonymisierten Patient des DKTK-Projekts" /></span></p><p><em>(Screengrab von&nbsp;<a class="external-link" href="https://simplifier.net/oncology/patientenpseudonym" rel="nofollow">https://simplifier.net/oncology/patientenpseudonym</a>&nbsp;)</em></p><p><br /></p><p><span>Die Kairos-FHIR-DSL repr&auml;sentiert die Struktur des FHIR-Profils. Die in der Bibliothek bereitgestellten Methoden tragen die Namen der zugeh&ouml;rigen Elemente eines FHIR-Profils. Es wird daher zun&auml;chst die &auml;u&szlig;ere Methode &quot;patient&quot; aufgerufen. Diese akzeptiert ein Closure als Argument. Hier werden zuerst zwei generelle Elemente einer FHIR-Ressource festgelegt. F&uuml;r das FHIR-Profil werden die Elemente &quot;id&quot; und &quot;meta&quot; gesetzt und deshalb k&ouml;nnen in diesem Closure die Methoden &quot;id&quot; und &quot;meta&quot; aufgerufen werden. Die <a class="external-link" href="http://www.hl7.org/fhir/resource.html" rel="nofollow">Basis-Definition einer FHIR-Resource</a> sieht folgenderma&szlig;en aus:<br /><br /></span></p><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image confluence-content-image-border" height="111" width="500" src="img_3.jpg" data-image-src="/download/attachments/64291632/Fhir-resource-profile.jpg?version=1&amp;modificationDate=1609850607115&amp;api=v2" data-unresolved-comment-count="0" data-linked-resource-id="65896677" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="Fhir-resource-profile.jpg" data-base-url="http://confluence.kairosbochum.de" data-linked-resource-content-type="image/jpeg" data-linked-resource-container-id="64291632" data-linked-resource-container-version="102" /></span></p><p><em>(Screengrab von&nbsp;<a class="external-link" href="http://www.hl7.org/fhir/resource.html" rel="nofollow">http://www.hl7.org/fhir/resource.html</a>&nbsp;)</em></p><p><br /></p><p><span>Das Element &quot;id&quot; ist ein &quot;Simple Type&quot;, es besitzt demnach einen Wert. Das Element &quot;meta&quot; ist wiederum ein &quot;Complex Type&quot; und kann folglich verschiedene Unterelemente besitzen. Im Detail sieht die Definition des komplexen Elements &quot;meta&quot; wie folgt aus:<br /><br /></span></p><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image confluence-content-image-border" height="159" width="500" src="img_4.jpg" data-image-src="/download/attachments/64291632/Meta-definition.jpg?version=1&amp;modificationDate=1609850929103&amp;api=v2" data-unresolved-comment-count="0" data-linked-resource-id="65896679" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="Meta-definition.jpg" data-base-url="http://confluence.kairosbochum.de" data-linked-resource-content-type="image/jpeg" data-linked-resource-container-id="64291632" data-linked-resource-container-version="102" /></span></p><p><em>(Screengrab von&nbsp;<a class="external-link" href="http://www.hl7.org/fhir/resource.html#Meta" rel="nofollow">http://www.hl7.org/fhir/resource.html#Meta</a>&nbsp;)</em></p><p>Damit werden auch die Methodenaufrufe im Groovy-Skript ersichtlicher. Prinzipiell repr&auml;sentieren diese, die Struktur des FHIR-Profils.</p><pre>patient <span>{<br /></span><span><br /></span><span>  </span>id = <span style="color: rgb(6,125,23);">&quot;Patient/&quot; </span>+ context.source[<span>patientMasterDataAnonymous</span>().patientContainer().id()]<br /><br />  meta <span>{<br /></span><span>    </span>profile <span style="color: rgb(6,125,23);">&quot;http://dktk.dkfz.de/fhir/StructureDefinition/onco-core-Patient-Pseudonym&quot;<br /></span><span style="color: rgb(6,125,23);">  </span><span>}</span><br />  ...<br />}</pre><p>Im Closure, welches die Methode &quot;patient&quot; als Argument akzeptiert, d&uuml;rfen die Methoden &quot;id&quot;, &quot;meta&quot;, &quot;implicitRules&quot; und &quot;language&quot; aufgerufen werden, da diese entsprechend in der Struktur-Definition des FHIR-Profils f&uuml;r eine Resource definiert sind. In IntelliJ kann das &uuml;berpr&uuml;ft werden, indem ein gew&uuml;nschter Element-Namen eingegeben wird. Dieser wird darauffolgend direkt von der Auto-Code-Vervollst&auml;ndigung angezeigt.</p><p>Im Beispiel wird au&szlig;erdem dem Feld &quot;id&quot; ein String zugewiesen. In Groovy k&ouml;nnen Klassen sogenannte Properties besitzen, welchen mit dieser Syntax direkt ein Wert zugewiesen werden kann. In Java entspricht eine Property einem &quot;private&quot; Feld einer Klasse. Diese Zuweisung ist somit analog zum Aufruf der zugeh&ouml;rigen Setter-Methode. Groovy bietet f&uuml;r Properties von Klassen direkt Setter- und Getter-Methoden an, ohne das diese implementiert werden m&uuml;ssen. Die oben gezeigte Zuweisung kann alternativ wie folgt geschrieben werden:</p><pre>patient <span>{</span><br /><br />  setId <span style="color: rgb(106,135,89);">&quot;Patient/&quot; + </span>context.source[<span>patientMasterDataAnonymous</span>().patientContainer().id()]<br />  ...<br />}<span style="color: rgb(106,135,89);"> <br /></span></pre><p>Der Ausdruck &quot;context.source&quot; wird weiter unten ausf&uuml;hrlicher erl&auml;utert.</p><p><span>Das Element &quot;meta&quot;&nbsp;kann weitere Unterelemente besitzen und daher nimmt die zugeh&ouml;rige Methode wiederum ein Closure als Argument. In diesem Closure k&ouml;nnen nun laut FHIR-Profil-Definition die Methoden &quot;versionId&quot;, &quot;lastUpdated&quot;, &quot;source&quot;, &quot;profile&quot;, &quot;security&quot; und &quot;tag&quot; aufgerufen werden. Die Auto-Vervollst&auml;ndigung sollte in IntelliJ folgenderma&szlig;en aussehen:<br /></span></p><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" width="500" src="img_5.jpg" data-image-src="/download/attachments/64291632/code_comp_meth.jpg?version=2&amp;modificationDate=1613070343719&amp;api=v2" data-unresolved-comment-count="0" data-linked-resource-id="65896782" data-linked-resource-version="2" data-linked-resource-type="attachment" data-linked-resource-default-alias="code_comp_meth.jpg" data-base-url="http://confluence.kairosbochum.de" data-linked-resource-content-type="image/jpeg" data-linked-resource-container-id="64291632" data-linked-resource-container-version="102" height="180" /></span><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" width="500" src="img_6.jpg" data-image-src="/download/attachments/64291632/code_comp_prop.jpg?version=2&amp;modificationDate=1613070344009&amp;api=v2" data-unresolved-comment-count="0" data-linked-resource-id="65896781" data-linked-resource-version="2" data-linked-resource-type="attachment" data-linked-resource-default-alias="code_comp_prop.jpg" data-base-url="http://confluence.kairosbochum.de" data-linked-resource-content-type="image/jpeg" data-linked-resource-container-id="64291632" data-linked-resource-container-version="102" height="176" /></span><br /><br /><span>Prinzipiell werden die Methoden entsprechend des zu kreierenden FHIR-Profils ineinander geschachtelt. Methoden, die einem FHIR-Element von komplexem Typ entsprechen akzeptieren ein Closure als Argument, in welchem genau die korrespondierenden Methoden f&uuml;r die Unterelemente aufgerufen werden k&ouml;nnen. In der Abbildung oben rechts sehen Sie das Beispiel der Code-Vervollst&auml;ndigung f&uuml;r die Methode &quot;security&quot;. Hat ein Element im FHIR-Profil nur einen Wert, so kann dieser direkt zugewiesen werden. Der entsprechende Aufruf ist in IntelliJ mit einem violett hinterlegten &bdquo;p&ldquo; gekennzeichnet (z.B.: &quot;versionId&quot; in linker Abbildung). Im Falle, dass unter &quot;meta&quot; das Feld &quot;versionId&quot; mit &quot;EXAMPLE-ID&quot; festgelegt werden soll, so sieht der Code wie folgt aus:</span></p><pre>patient <span>{<br /></span><span><br /></span><span>  </span>...<br />  meta <span>{<br /></span><span>    </span>profile <span style="color: rgb(6,125,23);">&quot;http://dktk.dkfz.de/fhir/StructureDefinition/onco-core-Patient-Pseudonym&quot;<br /></span><span style="color: rgb(6,125,23);">    </span>versionId = <span style="color: rgb(6,125,23);">&quot;EXAMPLE-ID&quot;<br /></span><span style="color: rgb(6,125,23);">  </span><span>}<br />  ...<br /> }<br /></span></pre><p>Soll nun das komplexe Element &quot;security&quot; gesetzt werden, so muss ein Closure aufgerufen werden. &quot;<a class="external-link" href="http://www.hl7.org/fhir/resource-definitions.html#Meta.security" rel="nofollow">meta.security</a>&quot; ist vom Typ Coding. Die Struktur f&uuml;r ein &quot;Coding&quot; ist <a class="external-link" href="http://www.hl7.org/fhir/resource-definitions.html#Meta.security" rel="nofollow">hier</a> definiert. Des Weiteren ist f&uuml;r &quot;Security&quot; ein&nbsp;<a class="external-link" href="http://www.hl7.org/fhir/valueset-security-labels.html" rel="nofollow">ValueSet</a> definiert. Mit dieser Information kann nun die DSL genutzt werden, um das entsprechende Closure bspw. wie folgt aufzurufen:</p><pre>patient <span>{<br /></span>  ...<br />  meta <span>{<br /></span><span>    </span>profile <span style="color: rgb(6,125,23);">&quot;http://dktk.dkfz.de/fhir/StructureDefinition/onco-core-Patient-Pseudonym&quot;<br /></span><span style="color: rgb(6,125,23);">    </span>versionId = <span style="color: rgb(6,125,23);">&quot;EXAMPLE-ID&quot;<br /></span><span style="color: rgb(6,125,23);">    </span>security <span>{<br /></span><span>      </span>system = <span style="color: rgb(6,125,23);">&quot;http://terminology.hl7.org/CodeSystem/v3-Confidentiality&quot;<br /></span><span style="color: rgb(6,125,23);">      </span>code = <span style="color: rgb(6,125,23);">&quot;U&quot;<br /></span><span style="color: rgb(6,125,23);">    </span><span>}<br /></span><span>  }<br />  ...<br />}<br /></span></pre><p><span>Dies ist nur ein Beispiel, um den Methodenaufruf mit einem Closure zu demonstrieren. Im eigentlichen Anwendungsfall k&ouml;nnen selbstverst&auml;ndlich die zugewiesenen Werte von den Daten der CentraXX-Entit&auml;t abh&auml;ngen.<br /></span></p><a name="Bookmark25"></a><h3 id="Bookmark25">CXX JPA Meta Model und die Verwendung von context.source mit der JPA-Navigation</h3><a name="Bookmark26"></a><h4 id="Bookmark26">JPA Meta Model</h4><p>Das Ziel der Mappings ist, die Daten einer CentraXX-Entit&auml;t auf ein FHIR-Profil abzubilden. Daf&uuml;r m&uuml;ssen die Daten vom Datenmodell der zu transformierenden CentraXX-Entit&auml;t abgerufen werden k&ouml;nnen. Dazu wird der Ausdruck &quot;context.source&quot; verwendet. Das Objekt &quot;context.source&quot; ist eine Repr&auml;sentation der CentraXX-Entit&auml;t in Form geschachtelter Hash-Maps. Eine Hash-Map ordnet einem Schl&uuml;ssel (Key) einen Wert (Value) zu. Als Schl&uuml;ssel wird jeweils der Name der Java JPA Property verwendet. Value ist entweder ein Simple Type (beispielsweise ein String), oder wiederum eine Hash-Map. Diese Struktur erm&ouml;glicht es in Groovy, Elemente in Form von geketteten Aufrufen, wie context.source[propertyX.propertryY.propertyZ] abzurufen. Im ersten Beispiel oben ist dieser Ausdruck bereits vorgekommen.</p><a name="Bookmark27"></a><h4 id="Bookmark27">Navigation mittels verketteter Methodenaufrufe</h4><p>Eine effiziente Nutzung der Datenabfrage &uuml;ber context.source ist nur m&ouml;glich, wenn die Struktur des JPA-Meta-Models bekannt ist und man somit wei&szlig;, welche Keys die CentraXX-Entit&auml;t &uuml;berhaupt besitzt. Dies wird in der Kairos-FHIR-DSL durch die Implementation hierarchische Klassen realisiert, welche die Struktur des JPA-Meta-Models repr&auml;sentieren. Diese Repr&auml;sentation basiert auf einem String-Builder, welcher Methoden zu den m&ouml;glichen JPA-Keys einer CentraXX-Entit&auml;t anbietet. Somit wird eine Navigationsm&ouml;glichkeit bereitgestellt, um passende Keys f&uuml;r die jeweiligen Entit&auml;ten zu generieren und daf&uuml;r Code-Vervollst&auml;ndigung zu nutzen. Die oberste Klasse &quot;RootEntities&quot; bietet hierzu statische Methoden zu allen verf&uuml;gbaren CentraXX-Entit&auml;ten mit korrespondierendem Namen an. Bei der folgenden Zuweisung der Property &quot;id&quot;, wird das Element &quot;id&quot; von context.source abgerufen.</p><pre>id = <span style="color: rgb(6,125,23);">&quot;Condition/&quot; </span>+ context.source[<span style="color: rgb(6,125,23);">&quot;id&quot;</span>]</pre><p>Mit Hilfe der JPA-Navigation kann dies folgenderma&szlig;en geschrieben werden:</p><pre>id = <span style="color: rgb(6,125,23);">&quot;Condition/&quot; </span>+ context.source[RootEntities.<span>diagnosis</span>().id()]</pre><p>Mit &quot;RootEntities.diagnosis()&quot; werden die Navigationsm&ouml;glichkeiten f&uuml;r die CentraXX-Entit&auml;t &quot;Diagnosis&quot; ausgew&auml;hlt. Dieser Ausdruck kann weiter vereinfacht werden. In einem Groovy-Skript wird nur eine CentraXX-Entit&auml;t transformiert und somit werden immer nur Werte von derselben Entit&auml;t abgerufen. &quot;RootEntities.diagnosis&quot; kann somit als statischer Import hinzugef&uuml;gt werden. Dazu rechtsklicken Sie in IntelliJ die Methode &quot;diagnosis()&quot; und gehen auf <span style="color: rgb(122,134,154);"><span style="color: rgb(0,51,102);">Show Context Actions &rarr; Add static import</span><span style="color: rgb(0,0,0);">. Somit kann der Ausdruck einfacher genutzt werden:</span></span></p><pre>id = <span style="color: rgb(6,125,23);">&quot;Condition/&quot; </span>+ context.source[<span>diagnosis</span>().id()]</pre><p>Oder hier ein weiteres Beispiel:</p><pre>subject <span>{<br /></span><span>  </span>reference = <span style="color: rgb(6,125,23);">&quot;Patient/&quot; </span>+ context.source[<span>diagnosis</span>().patientContainer().id()]<br /><span>}</span></pre><p><span>Es ist wichtig, sich klar zu machen, dass das &quot;RootEntities&quot; lediglich ein String-Builder ist, der je nach Aufruf seiner Methoden einen geketteten JPA-Schl&uuml;ssel als String zur&uuml;ckgibt. Die Daten der CentraXX-Entit&auml;t sind in contex.source enthalten. Mit den Strings, k&ouml;nnen die entsprechenden Elemente von context.source abgerufen werden. F&uuml;hrt man folgendes Skript aus,</span></p><pre><span style="color: rgb(0,51,179);">import </span>de.kairos.fhir.centraxx.metamodel.<span style="color: rgb(0,0,0);">RootEntities<br /></span><span style="color: rgb(0,0,0);"><br /></span>println <span style="color: rgb(0,0,0);">RootEntities</span>.<span>abstractSample</span>().active().path()<br />println <span style="color: rgb(0,0,0);">RootEntities</span>.<span>patientMasterDataAnonymous</span>().patientContainer().idContainer().creator().username().path()</pre><p>dann erh&auml;lt man folgenden Output:</p><p>&quot;active&quot;<br />&quot;patientcontainer.idContainer.creator.username&quot;</p><p>Die resultierenden Strings enthalten nicht den Namen der Centraxx-Entit&auml;t selbst (AbstractSample, PatientMasterDataAnonymous), da diese Information durch das Ressourcen-Mapping in contex.source enthalten ist. Die Methode &quot;path()&quot; ist die Builder-Methode, die den String zur&uuml;ckgibt. Diese Methode muss nicht explizit aufgerufen werden, wenn der Ausdruck innerhalb des Subscript-Operators von context.source aufgerufen wird, da context.source den Aufruf der &quot;path&quot;-Methode selbst implementiert.</p><a name="Bookmark28"></a><h4 id="Bookmark28">Verwendung von Konstanten in Listen-Closures</h4><p>In manchen F&auml;llen werden in Transformations-Skripten Listen von Elementen verarbeitet. Groovy-Listen bieten daf&uuml;r verschiedene Funktionen an, welche ein Closure als Argument akzeptieren. Im folgenden Beispiel aus dem Skript /dktk_with_jpa_navigation/specimen.groovy soll f&uuml;r jeden Eintrag im IdContainer ein FHIR-Element &quot;identifier&quot; festgelegt werden. Hierzu wird die Methode &quot;each&quot; verwendet:</p><pre>context.source[<span>abstractSample</span>().idContainer()]?.each <span>{ </span><span style="color: rgb(0,51,179);">final </span>idc <span>-&gt;<br /></span><span>  </span>identifier <span>{<br /></span><span>    </span>value = idc[<span style="color: rgb(135,16,148);">PSN</span>]<br />    type <span>{<br /></span><span>      </span>coding <span>{<br /></span><span>        </span>system = <span style="color: rgb(6,125,23);">&quot;urn:centraxx&quot;<br /></span><span style="color: rgb(6,125,23);">        </span>code = idc[<span style="color: rgb(135,16,148);">ID_CONTAINER_TYPE</span>]?.getAt(<span style="color: rgb(135,16,148);">CODE</span>)<br />      <span>}<br /></span><span>    }<br /></span><span>    </span>system = <span style="color: rgb(6,125,23);">&quot;urn:centraxx&quot;<br /></span><span style="color: rgb(6,125,23);">  </span><span>}<br /></span><span>}</span></pre><p><span>Zun&auml;chst wird der IdContainer abgefragt und mittels des <a class="external-link" href="https://groovy-lang.org/operators.html#_safe_navigation_operator" rel="nofollow">&quot;?&quot;-Operators</a> gepr&uuml;ft, ob dieser &uuml;berhaupt vorhanden ist. Beim Iterieren &uuml;ber die Elemente des IdContainers wird einer lokalen variable &quot;idc&quot; jeweils das Element zugewiesen. Im Closure der &quot;each&quot;-Methode werden nun wiederum Felder dieses Elements abgerufen. Jetzt befindet man sich allerdings nicht mehr in contex.source, sondern greift jetzt auf die Felder des neuen Objekts &quot;idc&quot; zu. Das Objekt &quot;idc&quot; ist wiederum eine geschachtelte <a class="external-link" href="http://groovy-lang.org/groovy-dev-kit.html#Collections-Maps" rel="nofollow">Map</a>. Um zu wissen, welche Keys diese Map besitzen kann, muss man wissen, welcher Entit&auml;t des CentraXX JPA-Model dieses Objekt entspricht. Dies findet man schnell heraus, wenn man sich anschaut, welchen Typ die Methode &quot;idContainer()&quot; zur&uuml;ckgibt. Dazu reicht es in IntelliJ den Cursor auf der entsprechenden Methode zu platzieren. Die Methode &quot;idContainer()&quot; gibt einen &quot;SampleIdContainer&quot; zur&uuml;ck. </span><span>Jede Klasse der JPA-Repr&auml;sentation bietet die zugeh&ouml;rigen Keys als Konstanten an. </span><span>Damit k&ouml;nnen nun die Felder von &quot;idc&quot; mit den passenden Keys abgerufen werden. Das Beispiel oben ist bereits mit statischen Importen vereinfacht. Die Aufrufe, die im Closure der &quot;identifier&quot;-Methode get&auml;tigt werden, sehen unvereinfacht wie folgt aus:</span></p><pre>identifier <span>{<br /></span><span>  </span>value = idc[<span style="color: rgb(0,0,0);">SampleIdContainer</span>.<span style="color: rgb(135,16,148);">PSN</span>]<br />  type <span>{<br /></span><span>    </span>coding <span>{<br /></span><span>      </span>system = <span style="color: rgb(6,125,23);">&quot;urn:centraxx&quot;<br /></span><span style="color: rgb(6,125,23);">      </span>code = idc[<span style="color: rgb(0,0,0);">SampleIdContainer</span>.<span style="color: rgb(135,16,148);">ID_CONTAINER_TYPE</span>]?.getAt(<span style="color: rgb(0,0,0);">IdContainerType</span>.<span style="color: rgb(135,16,148);">CODE</span>)<br />    <span>}<br /></span><span>  }<br /></span><span>  </span>system = <span style="color: rgb(6,125,23);">&quot;urn:centraxx&quot;<br /></span><span>}<br /></span></pre><p><span>Auf diese Weise funktioniert auch die zweite Zuweisung. Dort muss man wissen, dass &quot;idc[ID_CONTAINER_TYPE]&quot; ein Objekt vom Typ &quot;IdContainerType&quot; zur&uuml;ckgibt. Hier st&ouml;&szlig;t die Code-Vervollst&auml;ndigung allerdings an ihre Grenzen. Jedoch ist aus der Benamung der Klassen leicht zu erkennen, welcher Typ zur&uuml;ckgegeben wird. Alternativ kann man beim Skripten auch testweise den linearen Ausdruck schreiben und mittels der Code-Vervollst&auml;ndigung in IntelliJ den Return-Type herausfinden.&nbsp;&nbsp; </span></p><p><span><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" width="500" src="img_7.jpg" data-image-src="/download/attachments/64291632/code_completion_jpa.jpg?version=1&amp;modificationDate=1613066437173&amp;api=v2" data-unresolved-comment-count="0" data-linked-resource-id="65899368" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="code_completion_jpa.jpg" data-base-url="http://confluence.kairosbochum.de" data-linked-resource-content-type="image/jpeg" data-linked-resource-container-id="64291632" data-linked-resource-container-version="102" height="75" /></span></span></p><a name="Bookmark29"></a><h3 id="Bookmark29">Definition eigener Methoden, um CentraXX-Entit&auml;ten optimal abzubilden</h3><p><u>Beispiel 1: Abbildung des CentraXX Gender auf das Gender des DKTK-FHIR-Profils</u></p><p><span>Es treten F&auml;lle auf, in denen die Daten einer CentraXX-Identit&auml;t anders strukturiert sind als im zugeh&ouml;rigen FHIR-Profil. Dies h&auml;ngt bspw. davon ab, welcher Satz an Werten zur Beschreibung eines bestimmten Patienten-Stammdatenpunkts in einer CentraXX-Instanz definiert ist. Betrachten wir z.B. das Element &quot;Gender&quot; im FHIR-Profil im Vergleich zur Definition in CentraXX. F&uuml;r das FHIR-Profil ist folgender <a class="external-link" href="https://simplifier.net/packages/hl7.fhir.r4.core/4.0.1/files/81193" rel="nofollow">ValueSet</a> definiert. Nachfolgend wird ein Beispiel f&uuml;r die Dokumentation des Geschlechts eines Patienten in CentraXX und in der FHIR-Ressource &quot;Patient&quot; des DKTK-Projekts aufgef&uuml;hrt:</span></p><div class="table-wrap"><table class="wrapped confluenceTable" style="font-size:1.0em"><colgroup><col /><col /></colgroup><tbody><tr><th class="confluenceTh">CentraXX</th><th class="confluenceTh">DKTK FHIR Resource &quot;Patient&quot;</th></tr><tr><td class="confluenceTd" style="padding:0.5em">m&auml;nnlich<br />weiblich<br />hermaphroditisch<br />unbekannt<br />unbestimmt<br />sonstiges<br />divers</td><td class="confluenceTd" style="padding:0.5em"><p>male<br />female<br />other<br />unknown</p><p><br /></p></td></tr></tbody></table></div><p>Um die Werte optimal zu ordnen zu k&ouml;nnen, kann eine eigene Methode definiert werden, um das CentraXX-Gender abzubilden. Folgend ein Ausschnitt aus \dktk_with_jpa_navigation\patient.groovy:</p><pre>patient <span>{<br /></span><span style="color: rgb(6,125,23);"> </span><span style="color: rgb(0,51,179);"> ...<br /></span><span style="color: rgb(0,51,179);"><br />  </span><span style="color: rgb(0,51,179);">  if </span>(context.source[<span>patientMasterDataAnonymous</span>().genderType()]) {<br />    gender = <span>mapGender</span>(context.source[<span>patientMasterDataAnonymous</span>().genderType()] <span style="color: rgb(0,51,179);">as </span><span style="color: rgb(0,0,0);">GenderType</span>)<br />  }<br /><span>}<br /><br /></span></pre><p><span>Mittels if-Statement wird gepr&uuml;ft, ob f&uuml;r den zu transformierenden Patienten-Datensatz &uuml;berhaupt ein Gender angegeben ist. Dazu wird &quot;context.source&quot; genutzt, um dieses von der CentraXX-Entit&auml;t abzufragen. Ist das Gender definiert wird der Property &quot;gender&quot; der Wert mit der eigenen Methode &quot;mapGender()&quot; zugewiesen. Diese Methode ist folgenderma&szlig;en definiert:</span></p><pre><span style="color: rgb(0,51,179);">static </span><span style="color: rgb(0,0,0);">AdministrativeGender </span><span style="color: rgb(0,98,122);">mapGender</span>(<span style="color: rgb(0,51,179);">final </span><span style="color: rgb(0,0,0);">GenderType </span>genderType) {<br />  <span style="color: rgb(0,51,179);">switch </span>(genderType) {<br />    <span style="color: rgb(0,51,179);">case </span><span style="color: rgb(0,0,0);">GenderType</span>.<span style="color: rgb(135,16,148);">MALE</span>:<br />      <span style="color: rgb(0,51,179);">return </span><span style="color: rgb(0,0,0);">AdministrativeGender</span>.<span style="color: rgb(135,16,148);">MALE<br /></span><span style="color: rgb(135,16,148);">    </span><span style="color: rgb(0,51,179);">case </span><span style="color: rgb(0,0,0);">GenderType</span>.<span style="color: rgb(135,16,148);">FEMALE</span>:<br />      <span style="color: rgb(0,51,179);">return </span><span style="color: rgb(0,0,0);">AdministrativeGender</span>.<span style="color: rgb(135,16,148);">FEMALE<br /></span><span style="color: rgb(135,16,148);">    </span><span style="color: rgb(0,51,179);">case </span><span style="color: rgb(0,0,0);">GenderType</span>.<span style="color: rgb(135,16,148);">UNKNOWN</span>:<br />      <span style="color: rgb(0,51,179);">return </span><span style="color: rgb(0,0,0);">AdministrativeGender</span>.<span style="color: rgb(135,16,148);">UNKNOWN<br /></span><span style="color: rgb(135,16,148);">    </span><span style="color: rgb(0,51,179);">default</span>:<br />      <span style="color: rgb(0,51,179);">return </span><span style="color: rgb(0,0,0);">AdministrativeGender</span>.<span style="color: rgb(135,16,148);">OTHER<br /></span><span style="color: rgb(135,16,148);">  </span>}<br />}</pre><p>Mit einem Switch-Statement k&ouml;nnen die entsprechenden F&auml;lle zugeordnet werden. Da die zus&auml;tzlichen Gender, wie bspw. &quot;hermaphroditisch&quot; nicht im FHIR ValueSet definiert sind, werden diese im Beispiel auf &quot;Other&quot; abgebildet. In diesem Fall bietet die FHIR-Bibliothek ein Enum &quot;AdministrativeGender&quot; an, in welchem die konstanten Werte des ValueSets definiert sind.</p><p><span style="color: rgb(0,51,102);"><u>Beispiel 2: Setzen der &quot;identifier&quot; f&uuml;r DKTK FHIR-Profil Patient: </u></span></p><p>Das Element &quot;identifier&quot; des FHIR-Profils wird folgenderma&szlig;en festgelegt. Der folgende Code ist erneut ein Ausschnitt aus dem Beispielskript \dktk_with_jpa_navigation\patient.groovy:</p><pre>patient <span>{<br />  ...<br /><br /></span><span>  </span><span style="color: rgb(0,51,179);">final def </span><span style="color: rgb(0,0,0);">globalId </span>= context.source[<span>patientMasterDataAnonymous</span>().patientContainer().idContainer()]?.find <span>{<br /></span><span>    </span><span style="color: rgb(6,125,23);">&quot;DKTK&quot; </span>== it[<span style="color: rgb(135,16,148);">ID_CONTAINER_TYPE</span>]?.getAt(<span style="color: rgb(135,16,148);">CODE</span>) <span style="color: rgb(0,141,222);"><br /></span><span style="color: rgb(0,141,222);">  </span><span>}<br /></span><span><br /></span><span>  </span><span style="color: rgb(0,51,179);">if </span>(<span style="color: rgb(0,0,0);">globalId</span>) {<br />    identifier <span>{<br /></span><span>      </span>value = <span style="color: rgb(0,0,0);">globalId</span>[<span style="color: rgb(135,16,148);">PSN</span>]<br />      type <span>{<br /></span><span>        </span>coding <span>{<br /></span><span>          </span>system = <span style="color: rgb(6,125,23);">&quot;http://dktk.dkfz.de/fhir/onco/core/CodeSystem/PseudonymArtCS&quot;<br /></span><span style="color: rgb(6,125,23);">          </span>code = <span style="color: rgb(6,125,23);">&quot;Global&quot; </span><span style="color: rgb(0,141,222);"><br /></span><span style="color: rgb(0,141,222);">        </span><span>}<br /></span><span>      }<br /></span><span>    }<br /></span><span>  </span>}<br />  ...<br /><span>}</span></pre><p><span>Zuerst wird einer Variable &quot;globalId&quot; ein Wert zugewiesen. Groovy unterst&uuml;tzt sowohl statische als auch dynamische Typisierung. In diesem Fall wird &quot;globalId&quot; dynamisch typisiert. Sie nimmt also den Typ an, der Ihr zu Laufzeit zugewiesen wird. In Groovy wird dazu das Keyword &quot;def&quot; verwendet. <br />Mittels des &quot;?&quot;-Operator wird &uuml;berpr&uuml;ft, ob &uuml;berhaupt eine Property &quot;patientcontainer.idContainer&quot; vorhanden ist. Im Falle, dass diese vorhanden ist, so generiert context.source[&quot;patientContainer.idContainer&quot;] eine Liste zur&uuml;ck.&nbsp; Diese Liste enth&auml;lt wiederum geschachtelte Maps. In dieser Liste wird nach einem Element (also einer Map) gesucht, welches als Key die Property &quot;idContainerType&quot; besitzt. Da in CentraXX ein Patient prinzipiell mehrere IdContainer besitzen kann, wird das Ergebnis im .find Ausdruck weiter nach dem jeweiligen idContainertypeType mit dem &quot;code&quot;=&quot;DKTK&quot; gefiltert, um zu einem eindeutigen Ergebnis zu gelangen. Ist dies wiederum der Fall, so wird die Variable &quot;globalId&quot; mit dem Ergebnis, der Map, welche den IdContainer representiert, belegt. Wird keine passende Map gefunden bleibt &quot;globalId&quot; gleich null.</span></p><p><span>Der zweite Code-Abschnitt wird nur ausgef&uuml;hrt, wenn &bdquo;globalId&ldquo; ungleich null ist, sprich eine entsprechende Map existiert. Hierbei wird die Methode &quot;identifier&quot; des FHIR-Modells f&uuml;r den Zusammenbau eines Patienten aufgerufen. Dem Element &quot;value&quot; in &quot;identifier&quot; wird nun der Value aus der Map zum Key der Property &quot;psn&quot;, der vorher definierten Variablen &quot;globalId&quot; zugewiesen. </span></p><a name="Bookmark30"></a><h1 id="Bookmark30">FHIR-Export in Zielsysteme</h1><p>F&uuml;r die folgenden Beispiele wurde ein Projekt-Verzeichnis unter &quot;[centraxx-home]\fhir-custom-mappings\dktk&quot; angelegt. Innerhalb dieses wurden alle Groovy-Skripte aus dem Beispielprojekt (s. oben) abgelegt.&nbsp;</p><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" width="400" src="img_8.jpg" data-image-src="/download/attachments/64291632/test_proj_folder.jpg?version=1&amp;modificationDate=1610709942501&amp;api=v2" data-unresolved-comment-count="0" data-linked-resource-id="65897330" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="test_proj_folder.jpg" data-base-url="http://confluence.kairosbochum.de" data-linked-resource-content-type="image/jpeg" data-linked-resource-container-id="64291632" data-linked-resource-container-version="102" height="370" /></span></p><p>Die Konfigurationsdatei ExportResourceMappingConfig.json wurde f&uuml;r dieses Beispiel auf dem Standard-Zustand belassen (so wie sie nach dem ersten Start von CentraXX nach Anlegen des Projekt-Ordners von CentraXX erstellt wurde).&nbsp;</p><p><span>Es wurden drei Testpatienten in CentraXX angelegt. Des Weiteren wurde die Patienten-ID mit dem Code &quot;DKTK&quot; in CentraXX definiert. Diesen drei Testpatienten wurde eine solche &quot;DKTK&quot;-ID zugewiesen. Somit kann ein passender Patienten-Filter konfiguriert werden:</span></p><pre><span style="color: rgb(135,16,148);">&quot;patientFilterType&quot;</span>: {<br />  <span style="color: rgb(135,16,148);">&quot;description&quot;</span>: <span style="color: rgb(6,125,23);">&quot;..</span><span style="color: rgb(6,125,23);">.&quot;</span>,<br />  <span style="color: rgb(135,16,148);">&quot;value&quot;</span>: <span style="color: rgb(6,125,23);">&quot;IDTYPE&quot;<br /></span>},<br /><span style="color: rgb(135,16,148);">&quot;patientFilterValue&quot;</span>: {<br />  <span style="color: rgb(135,16,148);">&quot;description&quot;</span>: <span style="color: rgb(6,125,23);">&quot;The filter value.&quot;</span>,<br />  <span style="color: rgb(135,16,148);">&quot;value&quot;</span>: <span style="color: rgb(6,125,23);">&quot;DKTK&quot;<br /></span>},</pre><p>Zum Testen ist es hilfreich, wenn&nbsp; Ausleitungen zeitnah stattfinden. Dazu wird f&uuml;r die folgenden Beispiele ein Exportintervall auf alle f&uuml;nf Minuten konfiguriert:</p><pre><span style="color: rgb(135,16,148);">&quot;exportInterval&quot;</span>: {<br />  <span style="color: rgb(135,16,148);">&quot;description&quot;</span>: <span style="color: rgb(6,125,23);">&quot;Sets the export cron interval. Default is once a day.&quot;</span>,<br />  <span style="color: rgb(135,16,148);">&quot;value&quot;</span>: <span style="color: rgb(6,125,23);">&quot;0 */5 * * * *&quot;<br /></span>},</pre><p>Ein Beispiel f&uuml;r ein ausgeleitetes FHIR-Bundle der FHIR-Ressource Patient finden Sie im Anhang.</p><a name="Bookmark31"></a><h2 id="Bookmark31">Ausleitung in einen Blaze Store</h2><p><span>FHIR-Ressourcen k&ouml;nnen in einen Blaze-Store ausgeleitet werden. F&uuml;r dieses Beispiel wird das &quot;standalone JAR&quot;-Blaze verwendet. Hinweise zur Installation finden Sie unter <a class="external-link" href="https://alexanderkiel.gitbook.io/blaze/" rel="nofollow">https://alexanderkiel.gitbook.io/blaze/</a> und unter&nbsp;<a class="external-link" href="https://github.com/samply/blaze" rel="nofollow">https://github.com/samply/blaze</a>. Zus&auml;tzlich wird ein weiteres Command-Line-Tool verwendet, mit dem im nachfolgenden Beispiel die Anzahl der Ressourcen im Blaze-Store abgefragt werden k&ouml;nnen. Hinweise zur Installation und Nutzung von Blaze-CTL finden Sie unter&nbsp;<a class="external-link" href="https://github.com/samply/blazectl" rel="nofollow">https://github.com/samply/blazectl</a>.</span></p><p><span>Blaze bietet eine REST-full API standardm&auml;&szlig;ig unter http:\\localhost:8080\fhir an. F&uuml;r einen Export in den Blaze-Store m&uuml;ssen die Konfigurationen in ProjectConfig.json (spezifische Erl&auml;uterung im Abschnitt &quot;Einrichtung eines Projekts&quot;) angepasst werden. Der Export per HTTP muss aktiviert und die Adresse des Zielsystems festgelegt werden.</span></p><pre><span style="color: rgb(135,16,148);">&quot;uploadToUrl&quot;</span>: {<br />  <span style="color: rgb(135,16,148);">&quot;description&quot;</span>: <span style="color: rgb(6,125,23);">&quot;If true, the scheduler will export to the specified uploadUrl REST endpoint.&quot;</span>,<br />  <span style="color: rgb(135,16,148);">&quot;value&quot;</span>: <span style="color: rgb(0,51,179);">true<br /></span>},<br /><span style="color: rgb(135,16,148);">&quot;uploadUrl&quot;</span>: {<br />  <span style="color: rgb(135,16,148);">&quot;value&quot;</span>: <span style="color: rgb(6,125,23);">&quot;http://localhost:8080/fhir&quot;<br /></span>},</pre><p><span style="color: rgb(0,0,0);">Au&szlig;erdem werden f&uuml;r diesen Test alle Zertifikate zugelassen:</span></p><pre><span style="color: rgb(135,16,148);">&quot;sslTrustAllEnable&quot;</span>: {<br />  <span style="color: rgb(135,16,148);">&quot;description&quot;</span>: <span style="color: rgb(6,125,23);">&quot;If true, all ssl/tls certificates are trusted, otherwise the the default java store is used for SSL/TLS verification.&quot;</span>,<br />  <span style="color: rgb(135,16,148);">&quot;value&quot;</span>: <span style="color: rgb(0,51,179);">true<br /></span>},</pre><p><span style="color: rgb(0,0,0);">F&uuml;r erste Testzwecke ist es sinnvoll das Login der HTTP-Antwort des Zielservers zu aktivieren:</span></p><pre><span style="color: rgb(135,16,148);">&quot;prettyPrintEnable&quot;</span>: {<br />  <span style="color: rgb(135,16,148);">&quot;description&quot;</span>: <span style="color: rgb(6,125,23);">&quot;Print style the HTTP message body.&quot;</span>,<br />  <span style="color: rgb(135,16,148);">&quot;value&quot;</span>: <span style="color: rgb(0,51,179);">true<br /></span>},</pre><pre><span style="color: rgb(135,16,148);">&quot;fhirResponseValidationEnable&quot;</span>: {<br />  <span style="color: rgb(135,16,148);">&quot;description&quot;</span>: <span style="color: rgb(6,125,23);">&quot;If true, the HTTP message responses is parsed and each response entry is validated against its FHIR response status. Even if the HTTP response status is 200 ok, the status of a single entry might be 400 (bad request). If the status is not 200 or 201, an error is logged.&quot;</span>,<br />  <span style="color: rgb(135,16,148);">&quot;value&quot;</span>: <span style="color: rgb(0,51,179);">true<br /></span>}</pre><p><span style="color: rgb(0,0,0);">Die hier nicht aufgef&uuml;hrten Konfigurationen werden bei dem Standard-Werten belassen. Der Patientenfilter und das Ausleitungsintervall sind, wie oben beschrieben, konfiguriert.<br /></span></p><p><span style="color: rgb(0,0,0);">Die Konfigurationsdatei BundleRequestMethodConfig.json kann auf dem Standard-Zustand belassen werden. Standardisiert werden f&uuml;r alle FHIR-Ressourcen-Typen die PUT-Methode verwendet. Da Blaze ausschlie&szlig;lich PUT akzeptiert, bedarf es hier keiner Modifizierung.</span></p><p><span style="color: rgb(0,0,0);">CentraXX muss nun neu gestartet werden, um den neu konfigurierten Export zu aktivieren. Davor kann bereits Blaze selbst gestartet und eine erste Abfrage &uuml;ber die Anzahl der Ressourcen in Blaze get&auml;tigt werden. Dazu muss der folgende Befehl in einer Windows-PowerShell ausgef&uuml;hrt werden:&nbsp;<br /><br /></span></p><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" width="500" src="img_9.jpg" data-image-src="/download/attachments/64291632/blazectl_first.jpg?version=1&amp;modificationDate=1610650978437&amp;api=v2" data-unresolved-comment-count="0" data-linked-resource-id="65897292" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="blazectl_first.jpg" data-base-url="http://confluence.kairosbochum.de" data-linked-resource-content-type="image/jpeg" data-linked-resource-container-id="64291632" data-linked-resource-container-version="102" height="65" /></span></p><p><span style="color: rgb(0,0,0);"><br />Wie erwartet sind noch keine FHIR-Ressourcen in Blaze vorhanden. Nachdem CentraXX wieder gestartet ist, sollten bei einer erfolgreichen Konfiguration Eintr&auml;ge zum Export im Serverlog erhalten werden. Als Beispiel werden die Eintr&auml;ge f&uuml;r einen Export eines CentraXX-Patienten aufgef&uuml;hrt:</span></p><pre>2021-01-14 20:25:01,503 INFO [de.kairos.centraxx.timer.NfnExportScheduler] (cxxScheduledTask-19) Select CXX EntityType 'PATIENT_MASTER' transform by template 'vitalstatus' export to FHIR resource 'Observation'<br />2021-01-14 20:25:01,565 INFO [de.kairos.centraxx.fhir.r4.nfn.NfnExportManager] (cxxScheduledTask-19) Export bundle with '3' resources to target system '<a class="external-link" href="http://localhost:8080/fhir" rel="nofollow">http://localhost:8080/fhir</a>'<br />2021-01-14 20:25:01,568 INFO [de.kairos.centraxx.fhir.r4.nfn.NfnClient] (cxxScheduledTask-19) Cxx POST request: <a class="external-link" href="http://localhost:8080/fhir" rel="nofollow">http://localhost:8080/fhir</a><br />2021-01-14 20:25:01,608 INFO [de.kairos.centraxx.fhir.r4.nfn.NfnClient] (cxxScheduledTask-19) Cxx response: 200 </pre><p><span style="color: rgb(0,0,0);">F&uuml;r diesen Test sind in CentraXX genau drei Patienten vorhanden. Es existieren noch weitere Entit&auml;ten, welche exportiert wurden. Eine erneute Abfrage der Anzahl von FHIR-Ressourcen in Blaze ergibt das folgende Ergebnis:<br /><br /></span></p><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" width="500" src="img_10.png" data-image-src="/download/attachments/64291632/blazectl_2.png?version=1&amp;modificationDate=1610652947833&amp;api=v2" data-unresolved-comment-count="0" data-linked-resource-id="65897294" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="blazectl_2.png" data-base-url="http://confluence.kairosbochum.de" data-linked-resource-content-type="image/png" data-linked-resource-container-id="64291632" data-linked-resource-container-version="102" height="126" /></span></p><a name="Bookmark32"></a><h2 id="Bookmark32"><span style="color: rgb(0,0,0);">Ausleitung ins Dateisystem</span></h2><p><span style="color: rgb(0,0,0);">Die aus dem Transformations-Vorgang entsprungenen FHIR-Ressourcen k&ouml;nnen in Form von JSON-Dateien in das lokales Dateisystem ausgeleitet werden. Dazu m&uuml;ssen verschiedene Konfigurationen in der ProjectConfig.json vorgenommen werden. Der Export muss aktiviert und ein Zielverzeichnis festgelegt werden. Dieses Zielverzeichnis wird neu angelegt, im Falle, dass es nicht bereits existiert:</span></p><pre><span style="color: rgb(135,16,148);">&quot;exportToFileSystem&quot;</span>: {<br />  <span style="color: rgb(135,16,148);">&quot;description&quot;</span>: <span style="color: rgb(6,125,23);">&quot;If true, the scheduler will export to the specified file system exportFolder.&quot;</span>,<br />  <span style="color: rgb(135,16,148);">&quot;value&quot;</span>: <span style="color: rgb(0,51,179);">true<br /></span>},<br /><span style="color: rgb(135,16,148);">&quot;exportFolder&quot;</span>: {<br />  <span style="color: rgb(135,16,148);">&quot;value&quot;</span>: <span style="color: rgb(6,125,23);">&quot;C:/applications/centraxx-home/fhir-custom-export/test-export&quot;<br /></span>},</pre><p><span style="color: rgb(0,0,0);">Dar&uuml;ber hinaus relevante Konfiguration wie &quot;patientFilterType&quot;, &quot;patientFilterValue&quot;,&nbsp;&quot;exportInterval&quot; sind, wie oben beschrieben, vorgenommen worden.</span></p><p><span style="color: rgb(0,0,0);">Nach Neustart von CentraXX werden die JSON-Dateien im angegebenen Verzeichnis angezeigt:<br /><br /></span></p><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" width="500" src="img_11.jpg" data-image-src="/download/attachments/64291632/file_sys1.jpg?version=1&amp;modificationDate=1610707053282&amp;api=v2" data-unresolved-comment-count="0" data-linked-resource-id="65897325" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="file_sys1.jpg" data-base-url="http://confluence.kairosbochum.de" data-linked-resource-content-type="image/jpeg" data-linked-resource-container-id="64291632" data-linked-resource-container-version="102" height="139" /></span></p><a name="Bookmark33"></a><h1 id="Bookmark33">Anhang</h1><a name="Bookmark34"></a><h2 id="Bookmark34">Beispiel f&uuml;r ausgeleitetes FHIR-Bundle f&uuml;r die FHIR-Ressource &quot;Patient&quot;</h2><pre>{<br />  <span style="color: rgb(135,16,148);">&quot;resourceType&quot;</span>: <span style="color: rgb(6,125,23);">&quot;Bundle&quot;</span>,<br />  <span style="color: rgb(135,16,148);">&quot;type&quot;</span>: <span style="color: rgb(6,125,23);">&quot;transaction&quot;</span>,<br />  <span style="color: rgb(135,16,148);">&quot;total&quot;</span>: <span style="color: rgb(23,80,235);">3</span>,<br />  <span style="color: rgb(135,16,148);">&quot;entry&quot;</span>: [ {<br />    <span style="color: rgb(135,16,148);">&quot;fullUrl&quot;</span>: <span style="color: rgb(6,125,23);">&quot;Patient/1&quot;</span>,<br />    <span style="color: rgb(135,16,148);">&quot;resource&quot;</span>: {<br />      <span style="color: rgb(135,16,148);">&quot;resourceType&quot;</span>: <span style="color: rgb(6,125,23);">&quot;Patient&quot;</span>,<br />      <span style="color: rgb(135,16,148);">&quot;id&quot;</span>: <span style="color: rgb(6,125,23);">&quot;1&quot;</span>,<br />      <span style="color: rgb(135,16,148);">&quot;meta&quot;</span>: {<br />        <span style="color: rgb(135,16,148);">&quot;versionId&quot;</span>: <span style="color: rgb(6,125,23);">&quot;EXAMPLE-ID&quot;</span>,<br />        <span style="color: rgb(135,16,148);">&quot;profile&quot;</span>: [ <span style="color: rgb(6,125,23);">&quot;http://dktk.dkfz.de/fhir/StructureDefinition/onco-core-Patient-Pseudonym&quot; </span>],<br />        <span style="color: rgb(135,16,148);">&quot;security&quot;</span>: [ {<br />          <span style="color: rgb(135,16,148);">&quot;system&quot;</span>: <span style="color: rgb(6,125,23);">&quot;http://terminology.hl7.org/CodeSystem/v3-Confidentiality&quot;</span>,<br />          <span style="color: rgb(135,16,148);">&quot;code&quot;</span>: <span style="color: rgb(6,125,23);">&quot;U&quot;<br /></span><span style="color: rgb(6,125,23);">        </span>} ]<br />      },<br />      <span style="color: rgb(135,16,148);">&quot;identifier&quot;</span>: [ {<br />        <span style="color: rgb(135,16,148);">&quot;type&quot;</span>: {<br />          <span style="color: rgb(135,16,148);">&quot;coding&quot;</span>: [ {<br />            <span style="color: rgb(135,16,148);">&quot;system&quot;</span>: <span style="color: rgb(6,125,23);">&quot;http://dktk.dkfz.de/fhir/onco/core/CodeSystem/PseudonymArtCS&quot;</span>,<br />            <span style="color: rgb(135,16,148);">&quot;code&quot;</span>: <span style="color: rgb(6,125,23);">&quot;Global&quot;<br /></span><span style="color: rgb(6,125,23);">          </span>} ]<br />        },<br />        <span style="color: rgb(135,16,148);">&quot;value&quot;</span>: <span style="color: rgb(6,125,23);">&quot;DKTK-43134&quot;<br /></span><span style="color: rgb(6,125,23);">      </span>} ],<br />      <span style="color: rgb(135,16,148);">&quot;gender&quot;</span>: <span style="color: rgb(6,125,23);">&quot;female&quot;</span>,<br />      <span style="color: rgb(135,16,148);">&quot;birthDate&quot;</span>: <span style="color: rgb(6,125,23);">&quot;2020-01-01&quot;<br /></span><span style="color: rgb(6,125,23);">    </span>},<br />    <span style="color: rgb(135,16,148);">&quot;request&quot;</span>: {<br />      <span style="color: rgb(135,16,148);">&quot;method&quot;</span>: <span style="color: rgb(6,125,23);">&quot;PUT&quot;</span>,<br />      <span style="color: rgb(135,16,148);">&quot;url&quot;</span>: <span style="color: rgb(6,125,23);">&quot;Patient/1&quot;<br /></span><span style="color: rgb(6,125,23);">    </span>}<br />  }, {<br />    <span style="color: rgb(135,16,148);">&quot;fullUrl&quot;</span>: <span style="color: rgb(6,125,23);">&quot;Patient/2&quot;</span>,<br />    <span style="color: rgb(135,16,148);">&quot;resource&quot;</span>: {<br />      <span style="color: rgb(135,16,148);">&quot;resourceType&quot;</span>: <span style="color: rgb(6,125,23);">&quot;Patient&quot;</span>,<br />      <span style="color: rgb(135,16,148);">&quot;id&quot;</span>: <span style="color: rgb(6,125,23);">&quot;2&quot;</span>,<br />      <span style="color: rgb(135,16,148);">&quot;meta&quot;</span>: {<br />        <span style="color: rgb(135,16,148);">&quot;versionId&quot;</span>: <span style="color: rgb(6,125,23);">&quot;EXAMPLE-ID&quot;</span>,<br />        <span style="color: rgb(135,16,148);">&quot;profile&quot;</span>: [ <span style="color: rgb(6,125,23);">&quot;http://dktk.dkfz.de/fhir/StructureDefinition/onco-core-Patient-Pseudonym&quot; </span>],<br />        <span style="color: rgb(135,16,148);">&quot;security&quot;</span>: [ {<br />          <span style="color: rgb(135,16,148);">&quot;system&quot;</span>: <span style="color: rgb(6,125,23);">&quot;http://terminology.hl7.org/CodeSystem/v3-Confidentiality&quot;</span>,<br />          <span style="color: rgb(135,16,148);">&quot;code&quot;</span>: <span style="color: rgb(6,125,23);">&quot;U&quot;<br /></span><span style="color: rgb(6,125,23);">        </span>} ]<br />      },<br />      <span style="color: rgb(135,16,148);">&quot;identifier&quot;</span>: [ {<br />        <span style="color: rgb(135,16,148);">&quot;type&quot;</span>: {<br />          <span style="color: rgb(135,16,148);">&quot;coding&quot;</span>: [ {<br />            <span style="color: rgb(135,16,148);">&quot;system&quot;</span>: <span style="color: rgb(6,125,23);">&quot;http://dktk.dkfz.de/fhir/onco/core/CodeSystem/PseudonymArtCS&quot;</span>,<br />            <span style="color: rgb(135,16,148);">&quot;code&quot;</span>: <span style="color: rgb(6,125,23);">&quot;Global&quot;<br /></span><span style="color: rgb(6,125,23);">          </span>} ]<br />        },<br />        <span style="color: rgb(135,16,148);">&quot;value&quot;</span>: <span style="color: rgb(6,125,23);">&quot;DKTK-98521&quot;<br /></span><span style="color: rgb(6,125,23);">      </span>} ],<br />      <span style="color: rgb(135,16,148);">&quot;gender&quot;</span>: <span style="color: rgb(6,125,23);">&quot;male&quot;</span>,<br />      <span style="color: rgb(135,16,148);">&quot;birthDate&quot;</span>: <span style="color: rgb(6,125,23);">&quot;1956-01-01&quot;<br /></span><span style="color: rgb(6,125,23);">    </span>},<br />    <span style="color: rgb(135,16,148);">&quot;request&quot;</span>: {<br />      <span style="color: rgb(135,16,148);">&quot;method&quot;</span>: <span style="color: rgb(6,125,23);">&quot;PUT&quot;</span>,<br />      <span style="color: rgb(135,16,148);">&quot;url&quot;</span>: <span style="color: rgb(6,125,23);">&quot;Patient/2&quot;<br /></span><span style="color: rgb(6,125,23);">    </span>}<br />  }, {<br />    <span style="color: rgb(135,16,148);">&quot;fullUrl&quot;</span>: <span style="color: rgb(6,125,23);">&quot;Patient/11&quot;</span>,<br />    <span style="color: rgb(135,16,148);">&quot;resource&quot;</span>: {<br />      <span style="color: rgb(135,16,148);">&quot;resourceType&quot;</span>: <span style="color: rgb(6,125,23);">&quot;Patient&quot;</span>,<br />      <span style="color: rgb(135,16,148);">&quot;id&quot;</span>: <span style="color: rgb(6,125,23);">&quot;11&quot;</span>,<br />      <span style="color: rgb(135,16,148);">&quot;meta&quot;</span>: {<br />        <span style="color: rgb(135,16,148);">&quot;versionId&quot;</span>: <span style="color: rgb(6,125,23);">&quot;EXAMPLE-ID&quot;</span>,<br />        <span style="color: rgb(135,16,148);">&quot;profile&quot;</span>: [ <span style="color: rgb(6,125,23);">&quot;http://dktk.dkfz.de/fhir/StructureDefinition/onco-core-Patient-Pseudonym&quot; </span>],<br />        <span style="color: rgb(135,16,148);">&quot;security&quot;</span>: [ {<br />          <span style="color: rgb(135,16,148);">&quot;system&quot;</span>: <span style="color: rgb(6,125,23);">&quot;http://terminology.hl7.org/CodeSystem/v3-Confidentiality&quot;</span>,<br />          <span style="color: rgb(135,16,148);">&quot;code&quot;</span>: <span style="color: rgb(6,125,23);">&quot;U&quot;<br /></span><span style="color: rgb(6,125,23);">        </span>} ]<br />      },<br />      <span style="color: rgb(135,16,148);">&quot;identifier&quot;</span>: [ {<br />        <span style="color: rgb(135,16,148);">&quot;type&quot;</span>: {<br />          <span style="color: rgb(135,16,148);">&quot;coding&quot;</span>: [ {<br />            <span style="color: rgb(135,16,148);">&quot;system&quot;</span>: <span style="color: rgb(6,125,23);">&quot;http://dktk.dkfz.de/fhir/onco/core/CodeSystem/PseudonymArtCS&quot;</span>,<br />            <span style="color: rgb(135,16,148);">&quot;code&quot;</span>: <span style="color: rgb(6,125,23);">&quot;Global&quot;<br /></span><span style="color: rgb(6,125,23);">          </span>} ]<br />        },<br />        <span style="color: rgb(135,16,148);">&quot;value&quot;</span>: <span style="color: rgb(6,125,23);">&quot;DKTK-42313&quot;<br /></span><span style="color: rgb(6,125,23);">      </span>} ],<br />      <span style="color: rgb(135,16,148);">&quot;gender&quot;</span>: <span style="color: rgb(6,125,23);">&quot;other&quot;</span>,<br />      <span style="color: rgb(135,16,148);">&quot;birthDate&quot;</span>: <span style="color: rgb(6,125,23);">&quot;1993-01-01&quot;</span>,<br />      <span style="color: rgb(135,16,148);">&quot;deceasedDateTime&quot;</span>: <span style="color: rgb(6,125,23);">&quot;2021-01-01&quot;<br /></span><span style="color: rgb(6,125,23);">    </span>},<br />    <span style="color: rgb(135,16,148);">&quot;request&quot;</span>: {<br />      <span style="color: rgb(135,16,148);">&quot;method&quot;</span>: <span style="color: rgb(6,125,23);">&quot;PUT&quot;</span>,<br />      <span style="color: rgb(135,16,148);">&quot;url&quot;</span>: <span style="color: rgb(6,125,23);">&quot;Patient/11&quot;<br /></span><span style="color: rgb(6,125,23);">    </span>}<br />  } ]<br />}</pre><p><br /></p>
</div>
</div>
</div>
</div>
<script>
Split(['#sidebar', '#content'], {
    sizes: [15, 85],
    minSize: 100
});
</script>

</body>
</html>
